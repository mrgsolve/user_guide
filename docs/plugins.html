<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Plugins | mrgsolve User Guide</title>
<meta name="author" content="Metrum Research Group">
<meta name="description" content="9.1 autodec Available as of mrgsolve version 1.0.0. When this plugin is invoked, mrgsolve will search your model code for assignments and automatically declare them as double precision numbers....">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 9 Plugins | mrgsolve User Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mrgsolve.github.io/user_guide/plugins.html">
<meta property="og:description" content="9.1 autodec Available as of mrgsolve version 1.0.0. When this plugin is invoked, mrgsolve will search your model code for assignments and automatically declare them as double precision numbers....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Plugins | mrgsolve User Guide">
<meta name="twitter:site" content="@mrgsolve">
<meta name="twitter:description" content="9.1 autodec Available as of mrgsolve version 1.0.0. When this plugin is invoked, mrgsolve will search your model code for assignments and automatically declare them as double precision numbers....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bookstyle.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mrgsolve User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="model-components.html"><span class="header-section-number">1</span> Model components</a></li>
<li><a class="" href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></li>
<li><a class="" href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="" href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="" href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></li>
<li><a class="" href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></li>
<li><a class="" href="section-sequence.html"><span class="header-section-number">7</span> Simulation sequence</a></li>
<li><a class="" href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></li>
<li><a class="active" href="plugins.html"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="" href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="" href="topics.html"><span class="header-section-number">11</span> Topics</a></li>
<li><a class="" href="q-and-a.html"><span class="header-section-number">12</span> Questions and Answers</a></li>
<li><a class="" href="install.html"><span class="header-section-number">13</span> Installation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="plugins" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Plugins<a class="anchor" aria-label="anchor" href="#plugins"><i class="fas fa-link"></i></a>
</h1>
<div id="plugin-autodec" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> autodec<a class="anchor" aria-label="anchor" href="#plugin-autodec"><i class="fas fa-link"></i></a>
</h2>
<p>Available as of mrgsolve version 1.0.0.</p>
<p>When this plugin is invoked, mrgsolve will search your model code for assignments
and automatically declare them as <code>double</code> precision numbers. The following
blocks are searched</p>
<ul>
<li><code>$PREAMBLE</code></li>
<li>
<code>$MAIN</code> (or <code>$PK</code>)</li>
<li>
<code>$ODE</code> (or <code>$DES</code>)</li>
<li>
<code>$TABLE</code> (or <code>$ERROR</code>)</li>
<li><code>$PRED</code></li>
</ul>
<p>For example, the following code requires that <code>CL</code> gets assigned a type</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb328-1"><a href="plugins.html#cb328-1" aria-hidden="true" tabindex="-1"></a>$PARAM WT <span class="op">=</span> <span class="dv">70</span><span class="op">,</span> TVCL <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb328-2"><a href="plugins.html#cb328-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-3"><a href="plugins.html#cb328-3" aria-hidden="true" tabindex="-1"></a>$PK</span>
<span id="cb328-4"><a href="plugins.html#cb328-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> CL <span class="op">=</span> TVCL <span class="op">*</span> pow<span class="op">(</span>WT<span class="op">/</span><span class="dv">70</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">);</span></span></code></pre></div>
<p>This is the default mrgsolve behavior and has been since the beginning.</p>
<p>The <code>autodec</code> plugin lets you write the following</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb329-1"><a href="plugins.html#cb329-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN autodec </span>
<span id="cb329-2"><a href="plugins.html#cb329-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-3"><a href="plugins.html#cb329-3" aria-hidden="true" tabindex="-1"></a>$PARAM WT <span class="op">=</span> <span class="dv">70</span><span class="op">,</span> TVCL <span class="op">=</span> <span class="fl">1.2</span></span>
<span id="cb329-4"><a href="plugins.html#cb329-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-5"><a href="plugins.html#cb329-5" aria-hidden="true" tabindex="-1"></a>$PK</span>
<span id="cb329-6"><a href="plugins.html#cb329-6" aria-hidden="true" tabindex="-1"></a>CL <span class="op">=</span> TVCL <span class="op">*</span> pow<span class="op">(</span>WT<span class="op">/</span><span class="dv">70</span><span class="op">,</span> <span class="fl">0.75</span><span class="op">);</span></span></code></pre></div>
<p>mrgsolve will find <code>CL = ...</code> and understand that this is a user initiated
variable and will declare it as <code>double</code> for you. Don’t worry about <code>WT = 70</code>
in <code>$PARAM</code>; mrgsolve should already know about that won’t try to declare it.</p>
<p>When you are using the <code>autodec</code> plugin, you can still declare variables as
<code>double</code> or <code>int</code> or <code>bool</code>. mrgsolve already finds those variables and will
understand to leave those declarations alone. Note that it may still very
convenient to declare using the <code>capture</code> type those variables that you
want captured into the output</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb330-1"><a href="plugins.html#cb330-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN autodec</span>
<span id="cb330-2"><a href="plugins.html#cb330-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-3"><a href="plugins.html#cb330-3" aria-hidden="true" tabindex="-1"></a>$ERROR</span>
<span id="cb330-4"><a href="plugins.html#cb330-4" aria-hidden="true" tabindex="-1"></a>capture Y <span class="op">=</span> IPRED <span class="op">*</span> exp<span class="op">(</span>EPS<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span></code></pre></div>
<p>The <code>capture</code> typedef makes <code>Y</code> a <code>double</code>; we didn’t need to declare it with
<code>autodec</code> in play, but decided to declare with <code>capture</code> so that it is copied
into the simulated output.</p>
<p>The <code>autodec</code> plugin is intended for more straightforward models where most /
all variables are real valued. Because mrgsolve can handle any valid C++ code
in these blocks, there is a possibility that the code could get much more
complicated, including custom classes and methods. In this case, we recommend
to bypass this feature and take control of declaring variables as you would
in the default mode.</p>
<p>In case mrgsolve does try to declare (as <code>double</code>) a variable that shouldn’t
be handled that way, you can note this name in an environment variable inside
your model called <code>MRGSOLVE_AUTODEC_SKIP</code></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb331-1"><a href="plugins.html#cb331-1" aria-hidden="true" tabindex="-1"></a>$ENV MRGSOLVE_AUTODEC_SKIP <span class="op">=</span> c<span class="op">(</span><span class="st">"my_variable_1"</span><span class="op">)</span></span></code></pre></div>
<p>This can be a vector of variable names to NOT declare when <code>autodec</code> is invoked.</p>
</div>
<div id="plugin-nm-vars" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> nm-vars<a class="anchor" aria-label="anchor" href="#plugin-nm-vars"><i class="fas fa-link"></i></a>
</h2>
<p>Available as of mrgsolve version 1.0.0.</p>
<p>The <code>nm-vars</code> plugin provides a more NONMEM-like set of macros to use when
coding your compartmental model. Only a small subset of the NONMEM model syntax
is replicated here.</p>
<p><strong>F, R, D, ALAG</strong></p>
<ul>
<li>To set bioavailability for the nth compartment, use <code>Fn</code>
</li>
<li>To set the infusion rate for the nth compartment, use <code>Rn</code>
</li>
<li>To set the infusion duration for the nth compartment, use <code>Dn</code>
</li>
<li>To set the lag time for the nth compartment, use <code>ALAGn</code>
</li>
</ul>
<p>For example</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb332-1"><a href="plugins.html#cb332-1" aria-hidden="true" tabindex="-1"></a>$CMT GUT CENT GUT2</span>
<span id="cb332-2"><a href="plugins.html#cb332-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-3"><a href="plugins.html#cb332-3" aria-hidden="true" tabindex="-1"></a>$PK</span>
<span id="cb332-4"><a href="plugins.html#cb332-4" aria-hidden="true" tabindex="-1"></a>F1 <span class="op">=</span> <span class="fl">0.87</span><span class="op">;</span>    <span class="co">// equivalent to F_GUT  = 0.87;</span></span>
<span id="cb332-5"><a href="plugins.html#cb332-5" aria-hidden="true" tabindex="-1"></a>R2 <span class="op">=</span> <span class="fl">2.25</span><span class="op">;</span>    <span class="co">// equivalent to R_CENT = 2.25;</span></span>
<span id="cb332-6"><a href="plugins.html#cb332-6" aria-hidden="true" tabindex="-1"></a>ALAG3 <span class="op">=</span> <span class="fl">0.25</span><span class="op">;</span> <span class="co">// equivalent to ALAG_GUT2 = 0.25; </span></span></code></pre></div>
<p><strong>A, A_0, DADT</strong></p>
<ul>
<li>To refer to the amount in the nth compartment, use <code>A(n)</code>
</li>
<li>To refer to the initial amount in the nth compartment, use <code>A_0(n)</code>
</li>
<li>To refer to the differential equation for the nth compartment, use <code>DADT(n)</code>
</li>
</ul>
<p>For example</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb333-1"><a href="plugins.html#cb333-1" aria-hidden="true" tabindex="-1"></a>$CMT CMT1 CMT2</span>
<span id="cb333-2"><a href="plugins.html#cb333-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-3"><a href="plugins.html#cb333-3" aria-hidden="true" tabindex="-1"></a>$PK</span>
<span id="cb333-4"><a href="plugins.html#cb333-4" aria-hidden="true" tabindex="-1"></a>A_0<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb333-5"><a href="plugins.html#cb333-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb333-6"><a href="plugins.html#cb333-6" aria-hidden="true" tabindex="-1"></a>$DES</span>
<span id="cb333-7"><a href="plugins.html#cb333-7" aria-hidden="true" tabindex="-1"></a>DADT<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">=</span> <span class="op">-</span>KA <span class="op">*</span> A<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb333-8"><a href="plugins.html#cb333-8" aria-hidden="true" tabindex="-1"></a>DADT<span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span>  KA <span class="op">*</span> A<span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">-</span> KE <span class="op">*</span> A<span class="op">(</span><span class="dv">2</span><span class="op">);</span> </span></code></pre></div>
<p><strong>Math</strong></p>
<p>Starting with version 1.0.1, macros are provided for several math functions</p>
<ul>
<li>
<code>EXP(a)</code> gets mapped to <code>exp(a)</code>
</li>
<li>
<code>LOG(a)</code> gets mapped to <code>log(a)</code>
</li>
<li>
<code>SQRT(a)</code> gets mapped to <code>sqrt(a)</code>
</li>
</ul>
<p>These are purely for convenience, so that upper-case versions from NMTRAN don’t
require conversion to lower-case; this happens automatically via the C++
preprocessor.</p>
<p><strong>Other syntax</strong></p>
<ul>
<li>Using <code>THETA(n)</code> in model code will resolve to <code>THETAn</code>; this feature is
always available, even when <code>nm-vars</code> hasn’t been invoked; we mention it here
since it is a fundamental piece of the NONMEM syntax that mrgsolve has
internalized</li>
<li>Use <code>T</code> in <code>$DES</code> to refer to the current time in the odesolver rather
than <code>SOLVERTIME</code>
</li>
</ul>
<p><strong>Reserved words with nm-vars is invoked</strong></p>
<p>There are some additional reserved words when the <code>nm-vars</code> plugin is invoked</p>
<ul>
<li><code>A</code></li>
<li><code>A_0</code></li>
<li><code>DADT</code></li>
<li><code>T</code></li>
</ul>
<p>It is an error to use one of these symbols as the name of a parameter or
compartment or to try to declare them as variables.</p>
<p><strong>mrgsolve syntax that is still required</strong></p>
<p>There are a lot of differences remaining between mrgsolve and NONMEM syntax. We
mention a few here to make the point</p>
<ul>
<li>mrgsolve continues to require <code>pow(base, exponent)</code> rather than <code>base**exponent</code>
</li>
<li>mrgsolve continues to require a semi-colon at the end of each statement (this
is a C++ requirement)</li>
<li>mrgsolve continues to require that user-defined variables are declared with
a type, except when the <code>autodec</code> plugin (Section <a href="plugins.html#plugin-autodec">9.1</a>) is invoked</li>
</ul>
<p><strong>An example</strong></p>
<p>There is an example of this syntax (along with <code>autodec</code> features) in the
internal model library</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/modlib.html">modlib</a></span><span class="op">(</span><span class="st">"nm-like"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/see.html">see</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. 
. Model file:  nm-like.cpp 
. $PROB Model written with some nonmem-like syntax features
. 
. $PLUGIN nm-vars autodec
. 
. $PARAM
. THETA1 = 1, THETA2 = 21, THETA3 = 1.3, WT = 70, F1I = 0.5, D2I = 2
. KIN = 100, KOUT = 0.1, IC50 = 10, IMAX = 0.9
. 
. $CMT @number 3
. 
. $PK
. CL = THETA(1) * pow(WT/70, 0.75); 
. V  = THETA(2); 
. KA = THETA(3);
. 
. F1 = F1I;
. D2 = D2I;
. A_0(3) = KIN / KOUT;
. 
. $DES 
. CP = A(2)/V;
. INH = IMAX*CP/(IC50 + CP);
.   
. DADT(1) = -KA*A(1);
. DADT(2) =  KA*A(1) - (CL/V)*A(2);
. DADT(3) =  KIN * (1-INH) - KOUT * A(3);
. 
. $ERROR
. CP = A(2)/V;</code></pre>
</div>
<div id="plugin-tad" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> tad<a class="anchor" aria-label="anchor" href="#plugin-tad"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Purpose</strong>
Advanced calculation time after dose within your model. We call this “advanced”
because it lets you track doses in multiple compartments. See the note below
about a simpler way to calculate time after dose that should work fine if doses
are only in a single compartment. This functionality is provided by mrgsolve.</p>
<p><strong>Usage</strong></p>
<p>First, tell <code>mrgsolve</code> that you want to use the <code>tad</code> plugin</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb336-1"><a href="plugins.html#cb336-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN tad</span></code></pre></div>
<p>The create <code>tadose</code> objects, one for each compartment where you want to track
time after dose. One approach is to do this in <code>[ global ]</code></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb337-1"><a href="plugins.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>plugin<span class="op">]</span> tad</span>
<span id="cb337-2"><a href="plugins.html#cb337-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-3"><a href="plugins.html#cb337-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> global <span class="op">]</span> </span>
<span id="cb337-4"><a href="plugins.html#cb337-4" aria-hidden="true" tabindex="-1"></a>mrg<span class="op">::</span>tadose tad_cmt_1<span class="op">(</span><span class="dv">1</span><span class="op">);</span> </span>
<span id="cb337-5"><a href="plugins.html#cb337-5" aria-hidden="true" tabindex="-1"></a>mrg<span class="op">::</span>tadose tad_cmt_2<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span></code></pre></div>
<p>Notice that we pass the compartment number that we want to track in each
case and also that we refer to the <code>mrg::</code> namespace for the <code>tadose</code> class.</p>
<p>The <code>tadose</code> objects contain the following (public) members</p>
<ul>
<li>
<code>cmt</code> the compartment to track</li>
<li>
<code>told</code> the time of last dose; defaults to <code>-1e9</code>
</li>
<li>
<code>had_dose</code> indicates if a dose has already been given for the current
individual</li>
<li>
<code>tad(self)</code> the function to call to calculate time after dose
<ul>
<li>the <code>self</code> object (Section <a href="model-specification.html#self-object">2.3.12</a>) must be passed as the only
argument</li>
<li>when the member function is called prior to the first administered dose, a
value of <code>-1.0</code> is returned</li>
</ul>
</li>
<li>
<code>reset()</code> resets the state of the object; be sure to reset prior to simulating
a new individual</li>
</ul>
<p>As an example, you can call the <code>reset()</code> method on one of the <code>tadose</code> objects</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb338-1"><a href="plugins.html#cb338-1" aria-hidden="true" tabindex="-1"></a>tad_cmt_1<span class="op">.</span>reset<span class="op">();</span></span></code></pre></div>
<p>You can find the source code for this object
<a href="https://github.com/metrumresearchgroup/mrgsolve/blob/master/inst/base/mrgsolve-tad.h">here</a>.</p>
<p>A working example model that tracks doses in compartments <code>1</code> and <code>2</code> is
provided here</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb339-1"><a href="plugins.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>plugin<span class="op">]</span> tad</span>
<span id="cb339-2"><a href="plugins.html#cb339-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-3"><a href="plugins.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> global <span class="op">]</span> </span>
<span id="cb339-4"><a href="plugins.html#cb339-4" aria-hidden="true" tabindex="-1"></a>mrg<span class="op">::</span>tadose tad_cmt_1<span class="op">(</span><span class="dv">1</span><span class="op">);</span> </span>
<span id="cb339-5"><a href="plugins.html#cb339-5" aria-hidden="true" tabindex="-1"></a>mrg<span class="op">::</span>tadose tad_cmt_2<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb339-6"><a href="plugins.html#cb339-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-7"><a href="plugins.html#cb339-7" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> pkmodel <span class="op">]</span> cmt <span class="op">=</span> <span class="st">"GUT,CENT"</span><span class="op">,</span> depot <span class="op">=</span> TRUE</span>
<span id="cb339-8"><a href="plugins.html#cb339-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-9"><a href="plugins.html#cb339-9" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> param <span class="op">]</span> CL <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> V <span class="op">=</span> <span class="dv">20</span><span class="op">,</span> KA <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb339-10"><a href="plugins.html#cb339-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-11"><a href="plugins.html#cb339-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span> </span>
<span id="cb339-12"><a href="plugins.html#cb339-12" aria-hidden="true" tabindex="-1"></a>capture tad1 <span class="op">=</span> tad_cmt_1<span class="op">.</span>tad<span class="op">(</span>self<span class="op">);</span> </span>
<span id="cb339-13"><a href="plugins.html#cb339-13" aria-hidden="true" tabindex="-1"></a>capture tad2 <span class="op">=</span> tad_cmt_2<span class="op">.</span>tad<span class="op">(</span>self<span class="op">);</span></span></code></pre></div>
<p><strong>Static approach</strong></p>
<p>Another approach would be to make these static in <code>[ main ]</code> but this approach
would only work if you only use these in <code>[ main ]</code>; the <code>[ global ]</code> approach
is preferable since then you can access the object in any block (function).</p>
<div id="note" class="section level3" number="9.3.1">
<h3>
<span class="header-section-number">9.3.1</span> Note<a class="anchor" aria-label="anchor" href="#note"><i class="fas fa-link"></i></a>
</h3>
<p>Note there is a simpler way to calculate time after dose when only dosing into
a single compartment</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb340-1"><a href="plugins.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span></span>
<span id="cb340-2"><a href="plugins.html#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> tad <span class="op">=</span> self<span class="op">.</span>tad<span class="op">();</span></span></code></pre></div>
<p>The <code>self</code> object (Section <a href="model-specification.html#self-tad">2.3.20</a>) contains a <code>tad()</code> member which
will track time after dose. Note that this needs to be called every record.</p>
</div>
</div>
<div id="plugin-cxx11" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> CXX11<a class="anchor" aria-label="anchor" href="#plugin-cxx11"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Purpose</strong></p>
<p>Compile your model file with <code>C++11</code> standard.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb341-1"><a href="plugins.html#cb341-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN CXX11</span></code></pre></div>
</div>
<div id="plugin-rcpp" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Rcpp<a class="anchor" aria-label="anchor" href="#plugin-rcpp"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Purpose</strong></p>
<p>Link to <code>Rcpp</code> headers into your model.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb342-1"><a href="plugins.html#cb342-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN Rcpp</span></code></pre></div>
<p>Note that once your model is linked to <code>Rcpp</code>, you can start using that
functionality immediately (without including <code>Rcpp.h</code>).</p>
<p>A very useful feature provided by <code>Rcpp</code> is that it exposes all of the <code>dpqr</code>
functions that you normally use in R (e.g. <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> or <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code>). So, if you
want to simulate a number from Uniform (0,1) you can write</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb343-1"><a href="plugins.html#cb343-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN Rcpp</span>
<span id="cb343-2"><a href="plugins.html#cb343-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-3"><a href="plugins.html#cb343-3" aria-hidden="true" tabindex="-1"></a>$TABLE</span>
<span id="cb343-4"><a href="plugins.html#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> uni <span class="op">=</span> R<span class="op">::</span>runif<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span></code></pre></div>
<p>Note that the arguments are the same as the R version (<code><a href="https://rdrr.io/r/stats/Uniform.html">?runif</a></code>) <strong>except</strong>
there is no <code>n</code> argument; you always only get one draw.</p>
<p>Information about <code>Rcpp</code> can be found here: <a href="https://github.com/RcppCore/Rcpp" class="uri">https://github.com/RcppCore/Rcpp</a></p>
</div>
<div id="plugin-mrgx" class="section level2" number="9.6">
<h2>
<span class="header-section-number">9.6</span> mrgx<a class="anchor" aria-label="anchor" href="#plugin-mrgx"><i class="fas fa-link"></i></a>
</h2>
<p>Compile in extra C++ / Rcpp functions that can be helpful to you
for more advanced model coding. The <code>mrgx</code> plugin is dependent on the
<code>Rcpp</code> plugin.</p>
<p>The functions provided by <code>mrgx</code> are in a namespace of the same name,
so to invoke these functions, you always prepend <code>mrgx::</code>.</p>
<div id="get-the-model-environment" class="section level3" number="9.6.1">
<h3>
<span class="header-section-number">9.6.1</span> Get the model environment<a class="anchor" aria-label="anchor" href="#get-the-model-environment"><i class="fas fa-link"></i></a>
</h3>
<p>Note that your model object (<code>mod</code>) contains an R environment. For
example</p>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mrgsolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/house.html">house</a></span><span class="op">(</span><span class="op">)</span><span class="op">@</span><span class="va">envir</span></code></pre></div>
<pre><code>. &lt;environment: 0x7f82cce91ac8&gt;</code></pre>
<p>The objects in this environment are created by a block called <code>$ENV</code>
in your model code (see Section <a href="model-specification.html#block-env">2.2.26</a>);</p>
<p>To access this environment in your model, call</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb346-1"><a href="plugins.html#cb346-1" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>Environment env <span class="op">=</span> mrgx<span class="op">::</span>get_envir<span class="op">(</span>self<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="extract-an-object-from-the-model-environment" class="section level2" number="9.7">
<h2>
<span class="header-section-number">9.7</span> Extract an object from the model environment<a class="anchor" aria-label="anchor" href="#extract-an-object-from-the-model-environment"><i class="fas fa-link"></i></a>
</h2>
<p>When you have an object created in <code>$ENV</code></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb347-1"><a href="plugins.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> env <span class="op">]</span> </span>
<span id="cb347-2"><a href="plugins.html#cb347-2" aria-hidden="true" tabindex="-1"></a>rand <span class="op">&lt;-</span> rnorm<span class="op">(</span><span class="dv">100</span><span class="op">)</span></span></code></pre></div>
<p>You can extract this object with</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb348-1"><a href="plugins.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> preamble <span class="op">]</span></span>
<span id="cb348-2"><a href="plugins.html#cb348-2" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="op">::</span>NumericVector draw <span class="op">=</span> mrgx<span class="op">::</span>get<span class="op">(</span><span class="st">"rand"</span><span class="op">,</span> self<span class="op">);</span></span></code></pre></div>
</div>
<div id="rcpparmadillo" class="section level2" number="9.8">
<h2>
<span class="header-section-number">9.8</span> RcppArmadillo<a class="anchor" aria-label="anchor" href="#rcpparmadillo"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Purpose</strong></p>
<p>Link to <code>RcppArmadillo</code> headers into your model.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb349"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb349-1"><a href="plugins.html#cb349-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN RcppArmadillo</span></code></pre></div>
<p>Information about <code>armadillo</code> can be found here: <a href="http://arma.sourceforge.net/" class="uri">http://arma.sourceforge.net/</a>
Information about <code>RcppArmadillo</code> can be found here:
<a href="https://github.com/RcppCore/RcppArmadillo" class="uri">https://github.com/RcppCore/RcppArmadillo</a></p>
</div>
<div id="bh" class="section level2" number="9.9">
<h2>
<span class="header-section-number">9.9</span> BH<a class="anchor" aria-label="anchor" href="#bh"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Purpose</strong></p>
<p>Link to <code>boost</code> headers into your model.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb350"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb350-1"><a href="plugins.html#cb350-1" aria-hidden="true" tabindex="-1"></a>$PLUGIN BH</span></code></pre></div>
<p>Note that once your model is linked to <code>BH</code> (<code>boost</code>), you will be able to
include the <code>boost</code> header file that you need. You have to include the header
file that contains the <code>boost</code> function you want to use.</p>
<p>Information about <code>boost</code> can be found here: <a href="https://boost.org" class="uri">https://boost.org</a>. Information
about <code>BH</code> can be found here: <a href="https://github.com/eddelbuettel/bh" class="uri">https://github.com/eddelbuettel/bh</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></div>
<div class="next"><a href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#plugins"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="nav-link" href="#plugin-autodec"><span class="header-section-number">9.1</span> autodec</a></li>
<li><a class="nav-link" href="#plugin-nm-vars"><span class="header-section-number">9.2</span> nm-vars</a></li>
<li>
<a class="nav-link" href="#plugin-tad"><span class="header-section-number">9.3</span> tad</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#note"><span class="header-section-number">9.3.1</span> Note</a></li></ul>
</li>
<li><a class="nav-link" href="#plugin-cxx11"><span class="header-section-number">9.4</span> CXX11</a></li>
<li><a class="nav-link" href="#plugin-rcpp"><span class="header-section-number">9.5</span> Rcpp</a></li>
<li>
<a class="nav-link" href="#plugin-mrgx"><span class="header-section-number">9.6</span> mrgx</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#get-the-model-environment"><span class="header-section-number">9.6.1</span> Get the model environment</a></li></ul>
</li>
<li><a class="nav-link" href="#extract-an-object-from-the-model-environment"><span class="header-section-number">9.7</span> Extract an object from the model environment</a></li>
<li><a class="nav-link" href="#rcpparmadillo"><span class="header-section-number">9.8</span> RcppArmadillo</a></li>
<li><a class="nav-link" href="#bh"><span class="header-section-number">9.9</span> BH</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mrgsolve User Guide</strong>" was written by <font color="DarkGreen">Metrum Research Group</font>. It was last built on 2022-03-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
