<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Event objects | mrgsolve User Guide</title>
<meta name="author" content="Metrum Research Group">
<meta name="description" content="Event objects are similar to the data sets described in 3, but are simpler and easier to create. This is the fastest way to implement a basic intervention (like dosing) for a single “individual”...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 4 Event objects | mrgsolve User Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mrgsolve.github.io/user_guide/event-chapter.html">
<meta property="og:description" content="Event objects are similar to the data sets described in 3, but are simpler and easier to create. This is the fastest way to implement a basic intervention (like dosing) for a single “individual”...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Event objects | mrgsolve User Guide">
<meta name="twitter:site" content="@mrgsolve">
<meta name="twitter:description" content="Event objects are similar to the data sets described in 3, but are simpler and easier to create. This is the fastest way to implement a basic intervention (like dosing) for a single “individual”...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bookstyle.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mrgsolve User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="model-components.html"><span class="header-section-number">1</span> Model components</a></li>
<li><a class="" href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></li>
<li><a class="" href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="active" href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="" href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></li>
<li><a class="" href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></li>
<li><a class="" href="section-sequence.html"><span class="header-section-number">7</span> Simulation sequence</a></li>
<li><a class="" href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></li>
<li><a class="" href="plugins.html"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="" href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="" href="topics.html"><span class="header-section-number">11</span> Topics</a></li>
<li><a class="" href="q-and-a.html"><span class="header-section-number">12</span> Questions and Answers</a></li>
<li><a class="" href="install.html"><span class="header-section-number">13</span> Installation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="event-chapter" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Event objects<a class="anchor" aria-label="anchor" href="#event-chapter"><i class="fas fa-link"></i></a>
</h1>
<p>Event objects are similar to the data sets described in <a href="data-set-chapter.html#data-set-chapter">3</a>,
but are simpler and easier to create. This is the fastest way to implement a
basic intervention (like dosing) for a single “individual” into your model.</p>
<p>Event objects also offer an elegant way to compose complicated dosing regimens.
Typically, the different parts of a regimen are composed as individual event
objects and then combined to create a multi-faceted dose regiment.</p>
<p>Finally, once an event object is created (either simple or complex), this
object can be “expanded” into multiple individuals to create a population
data set for simulation.</p>
<p>See details in the subsequent sections.</p>
<div id="usage" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Usage<a class="anchor" aria-label="anchor" href="#usage"><i class="fas fa-link"></i></a>
</h2>
<p>Event objects are frequently used in a pipeline to simulate a dosing regimen.
For example</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">house</span><span class="op">(</span>end <span class="op">=</span> <span class="fl">72</span><span class="op">)</span> 

<span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mrgsim</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="st">"CP"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="user-guide_files/figure-html/unnamed-chunk-120-1.png" width="672"></div>
<p>This used the <code>ev()</code> constructor to make an event object for two 100 mg doses
and this is passed into <code>mrgsim()</code> to implement this regimen.</p>
<p>Alternatively, we can create a standalone object and feed that into the pipeline</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">regimen</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">ev</span><span class="op">(</span><span class="va">regimen</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mrgsim</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="st">"CP"</span><span class="op">)</span></code></pre></div>
<p>If you are not using the pipe syntax, the following would be equivalent
calls</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mrgsim</span><span class="op">(</span><span class="va">mod</span>, events <span class="op">=</span> <span class="va">regimen</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="st">"CP"</span><span class="op">)</span></code></pre></div>
<p>And there are <code>mrgsim()</code> variants that explicitly accept an event object</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mrgsim_e</span><span class="op">(</span><span class="va">mod</span>, <span class="va">regimen</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="st">"CP"</span><span class="op">)</span></code></pre></div>
<p>More will be said about how to create and manipulate event objects in the
following sections.</p>
</div>
<div id="construction" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Construction<a class="anchor" aria-label="anchor" href="#construction"><i class="fas fa-link"></i></a>
</h2>
<p>A new event object can be created with the <code>ev()</code> constructor. For a single,
100 mg dose it would be</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>When you print the object to the R console we see the 100 mg dose along with
the following defaults</p>
<ul>
<li>
<code>time</code> set to 0</li>
<li>
<code>cmt</code> set to 1 (the first compartment)</li>
<li>
<code>evid</code> set to 1 (a bolus dose)</li>
</ul>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span></code></pre></div>
<pre><code>. Events:
.   time amt cmt evid
. 1    0 100   1    1</code></pre>
<p>Of course, we can override any of these defaults or add additional items as
needed. For a single 100 mg dose infused over 2 hours in compartment 2 one
hour after the simulation starts</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, rate <span class="op">=</span> <span class="fl">50</span>, cmt <span class="op">=</span> <span class="fl">2</span>, time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>To use this event object, we can pass it into <code>mrgsim()</code> under the <code>events</code>
argument</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">house</span><span class="op">(</span>delta <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>

<span class="fu">mrgsim</span><span class="op">(</span><span class="va">mod</span>, events <span class="op">=</span> <span class="va">e</span><span class="op">)</span></code></pre></div>
<pre><code>. Model:  housemodel 
. Dim:    26 x 7 
. Time:   0 to 24 
. ID:     1 
.     ID time GUT  CENT  RESP    DV    CP
. 1:   1    0   0  0.00 50.00 0.000 0.000
. 2:   1    1   0  0.00 50.00 0.000 0.000
. 3:   1    1   0  0.00 50.00 0.000 0.000
. 4:   1    2   0 48.77 44.12 2.439 2.439
. 5:   1    3   0 95.16 36.98 4.758 4.758
. 6:   1    4   0 90.52 34.61 4.526 4.526
. 7:   1    5   0 86.11 34.75 4.305 4.305
. 8:   1    6   0 81.91 35.22 4.095 4.095</code></pre>
<p>Event object inputs can be functions of previously defined inputs. For example</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, rate <span class="op">=</span> <span class="va">amt</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt rate cmt evid
. 1    0 100   50   1    1</code></pre>
<p>See the <code>?ev()</code> help topic for more information on additional arguments
when constructing event objects. Here, I’d like to specifically highlight a
handful of options that can be helpful when constructing event objects.</p>
<p><strong>Infusion duration</strong></p>
<p>Above, we created some infusion event objects by adding an infusion rate to the
input. We can also indicate an infusion by adding an infusion time through
the <code>tinf</code> argument</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, tinf <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt rate cmt evid tinf
. 1    0 100   50   1    1    2</code></pre>
<p><strong>ID</strong></p>
<p>While the primary use case for event objects are for <em>single individuals</em>,
we can code a series of IDs into the object too</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   ID time amt cmt evid
. 1  1    0 100   1    1
. 2  2    0 100   1    1
. 3  3    0 100   1    1</code></pre>
<p>Here, we asked for 3 IDs in the object. Once this is turned into a simulation
data set (see below), we’ll have a population data set from which to simulate.</p>
<p><strong>Additional data items</strong></p>
<p>We can also pass through arbitrary data columns through the event object. For
example, we can pass through <code>WT</code></p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, WT <span class="op">=</span> <span class="fl">80</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt cmt evid WT
. 1    0 100   1    1 80</code></pre>
</div>
<div id="coerce-to-data-set" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Coerce to data set<a class="anchor" aria-label="anchor" href="#coerce-to-data-set"><i class="fas fa-link"></i></a>
</h2>
<p>As we noted, event objects are very similar to data sets and they are nothing
but data sets under the hood. We can take the event objects we created above
and coerce them to other objects.</p>
<p><strong>Using as_data_set</strong></p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_data_set</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></code></pre></div>
<pre><code>.   time amt rate cmt evid ID
. 1    1 100   50   2    1  1</code></pre>
<p>This will ensure that there is an <code>ID</code> column in the output and it will
be suitable to use for simulation.</p>
<p><strong>Using as.data.frame</strong></p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>.   time amt rate cmt evid ID
. 1    1 100   50   2    1  5</code></pre>
</div>
<div id="extract-information" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Extract information<a class="anchor" aria-label="anchor" href="#extract-information"><i class="fas fa-link"></i></a>
</h2>
<p>There is a <code>$</code> operator for event objects</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span><span class="op">$</span><span class="va">amt</span></code></pre></div>
<pre><code>. [1] 100</code></pre>
</div>
<div id="combining-event-objects" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Combining event objects<a class="anchor" aria-label="anchor" href="#combining-event-objects"><i class="fas fa-link"></i></a>
</h2>
<div id="concatenate" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Concatenate<a class="anchor" aria-label="anchor" href="#concatenate"><i class="fas fa-link"></i></a>
</h3>
<p>Two or more event objects can be concatenated using the <code>c</code> operator</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, time <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt cmt evid
. 1    0 100   1    1
. 2   24 200   1    1</code></pre>
<p>This essentially “rbinds” the rows of the individual event objects and
sorts the rows by <code>time</code>.</p>
<p><strong>NOTE</strong>: the result of this manipulation is another event object.</p>
</div>
<div id="sequence" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> Sequence<a class="anchor" aria-label="anchor" href="#sequence"><i class="fas fa-link"></i></a>
</h3>
<p>Event objects can also be combined to happen in a sequence. In the previous
example, we wanted the 200 mg to happen at 24 hours and we had to code that
fact into <code>time</code> accordingly.</p>
<p>By specifying a dosing interval (<code>ii</code>) we can ask mrgsolve to do that
automatically by calling the <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> method.</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>
<span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, ii <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 24    0   1    1
. 2   24 200 24    0   1    1</code></pre>
<p>This was a trivial example to get a simple result. We can try something more
complicated to make the point</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e3</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">6</span>,  addl <span class="op">=</span> <span class="fl">28</span><span class="op">)</span>
<span class="va">e4</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, ii <span class="op">=</span> <span class="fl">12</span>, addl <span class="op">=</span> <span class="fl">124</span><span class="op">)</span>
<span class="va">e5</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">400</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e3</span>, <span class="va">e4</span>, <span class="va">e5</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100  6   28   1    1
. 2  174 200 12  124   1    1
. 3 1674 400 24    3   1    1</code></pre>
<p><strong>NOTE</strong>: when mrgsolve puts event objects into a sequence, it starts the
next segment of the regimen one dosing interval after the previous regimen
finished. Going back to the simple example</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 24    0   1    1
. 2   24 200 24    0   1    1</code></pre>
<p><code>e1</code> was just a single dose at time 0. mrgsolve will have <code>e2</code> start one dosing
interval (24 hours) after the last (only) dose in <code>e1</code>. We can alter the amount
of time between segments of the regimen by using the <code>wait</code> argument. For
example, to push <code>e2</code> out by an additional 24 hours we’d use</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e1</span>, wait <span class="op">=</span> <span class="fl">24</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 24    0   1    1
. 2   48 200 24    0   1    1</code></pre>
<p>We can also use a negative value for <code>wait</code> to make the next dose happen sooner</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e1</span>, wait <span class="op">=</span> <span class="op">-</span><span class="fl">12</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 24    0   1    1
. 2   12 200 24    0   1    1</code></pre>
<p>Finally, we should note that event objects can be used multiple times in a
sequence</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span>, wait <span class="op">=</span> <span class="fl">7</span><span class="op">*</span><span class="fl">24</span>, <span class="va">e2</span>, <span class="va">e1</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 24    0   1    1
. 2   24 200 24    0   1    1
. 3  216 200 24    0   1    1
. 4  240 100 24    0   1    1</code></pre>
</div>
<div id="repeat" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> repeat<a class="anchor" aria-label="anchor" href="#repeat"><i class="fas fa-link"></i></a>
</h3>
<p>Like the <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> method for event objects, <code>ev_repeat</code> will put an event object
into a sequence <code>n</code> times</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev_repeat</span><span class="op">(</span><span class="va">e1</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>.   time amt ii cmt evid addl
. 1    0 100 24   1    1    0
. 2   24 100 24   1    1    0
. 3   48 100 24   1    1    0</code></pre>
<p>By default, this function returns a regular data frame. To return an event
object instead call</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev_repeat</span><span class="op">(</span><span class="va">e1</span>, n <span class="op">=</span> <span class="fl">3</span>, as.ev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>You can put a waiting period too. To illustrate this, let’s compose a more
complicated regimen and repeat that</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e1</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">500</span>, ii <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>
<span class="va">e2</span> <span class="op">&lt;-</span> <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">250</span>, ii <span class="op">=</span> <span class="fl">24</span>, addl <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">e3</span> <span class="op">&lt;-</span> <span class="fu">ev_seq</span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span><span class="op">)</span>

<span class="va">e3</span> <span class="op">%&gt;%</span> <span class="fu">realize_addl</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 500  0    0   1    1
. 2   24 250  0    0   1    1
. 3   48 250  0    0   1    1
. 4   72 250  0    0   1    1
. 5   96 250  0    0   1    1
. 6  120 250  0    0   1    1
. 7  144 250  0    0   1    1</code></pre>
<p>In this regimen, we have daily dosing for 7 doses. The last dose is given
at 144 hours. When putting this into a sequence, we’ll wait one dosing interval
and then the <code>wait</code> period and then start again</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev_repeat</span><span class="op">(</span><span class="va">e3</span>, n <span class="op">=</span> <span class="fl">3</span>, wait <span class="op">=</span> <span class="fl">7</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span></code></pre></div>
<pre><code>.   time amt ii addl cmt evid
. 1    0 500 24    0   1    1
. 2   24 250 24    5   1    1
. 3  336 500 24    0   1    1
. 4  360 250 24    5   1    1
. 5  672 500 24    0   1    1
. 6  696 250 24    5   1    1</code></pre>
</div>
<div id="create-a-data_set" class="section level3" number="4.5.4">
<h3>
<span class="header-section-number">4.5.4</span> Create a “data_set”<a class="anchor" aria-label="anchor" href="#create-a-data_set"><i class="fas fa-link"></i></a>
</h3>
<p>Use the <code>as_data_set()</code> function to combine multiple event objects into a single
data set.</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_data_set</span><span class="op">(</span><span class="va">e1</span>, <span class="va">e2</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID time cmt evid amt ii addl
. 1  1    0   1    1 500 24    0
. 2  2    0   1    1 250 24    5</code></pre>
<p>It’s important to note that</p>
<ol style="list-style-type: decimal">
<li>The result is a regular old <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>; once you call <code>as_data_set()</code>,
you exit the event object world</li>
<li>Each event object is given a different <code>ID</code>
</li>
</ol>
<p>Recall that we can create event objects with multiple <code>IDs</code>; <code>as_data_set()</code>
is handy to use with this feature</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_data_set</span><span class="op">(</span>
  <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, 
  <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, 
  <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">300</span>, ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>.   ID time cmt evid amt
. 1  1    0   1    1 100
. 2  2    0   1    1 100
. 3  3    0   1    1 100
. 4  4    0   1    1 200
. 5  5    0   1    1 200
. 6  6    0   1    1 200
. 7  7    0   1    1 300
. 8  8    0   1    1 300</code></pre>
<p>Notice that <code>as_data_set</code> has created unique IDs for the 3 subjects in
the 100 mg group, the 3 subjects in the 200 mg group, and the 2 subjects in
the 300 mg group.</p>
<p>We’ll cover a function called <code>ev_rep()</code> below to “expand” an event object to
multiple individuals</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_data_set</span><span class="op">(</span>
  <span class="va">e1</span> <span class="op">%&gt;%</span> <span class="fu">ev_rep</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">300</span><span class="op">)</span>,
  <span class="va">e2</span> <span class="op">%&gt;%</span> <span class="fu">ev_rep</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">300</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="modifying-an-event-object" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Modifying an event object<a class="anchor" aria-label="anchor" href="#modifying-an-event-object"><i class="fas fa-link"></i></a>
</h2>
<div id="tidy-like-manipulation" class="section level3" number="4.6.1">
<h3>
<span class="header-section-number">4.6.1</span> Tidy-like manipulation<a class="anchor" aria-label="anchor" href="#tidy-like-manipulation"><i class="fas fa-link"></i></a>
</h3>
<p>Event objects can be mutated</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mutate</span><span class="op">(</span><span class="va">e</span>, amt <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt rate cmt evid
. 1    1 200   50   2    1</code></pre>
<p>Columns can be removed from event objects</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, WT <span class="op">=</span> <span class="fl">50</span>, AGE <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">WT</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt cmt evid AGE
. 1    0 100   1    1  12</code></pre>
<p>Rows can be removed from event objects</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">200</span>, time <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">300</span>, time <span class="op">=</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">e</span>, <span class="va">time</span> <span class="op">&lt;=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt cmt evid
. 1    0 100   1    1
. 2   12 200   1    1</code></pre>
</div>
<div id="realize_addl" class="section level3" number="4.6.2">
<h3>
<span class="header-section-number">4.6.2</span> realize_addl<a class="anchor" aria-label="anchor" href="#realize_addl"><i class="fas fa-link"></i></a>
</h3>
<p>“Additional” doses can be made explicit in an event object</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span>, ii <span class="op">=</span> <span class="fl">6</span>, addl <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">realize_addl</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100  0    0   1    1
. 2    6 100  0    0   1    1
. 3   12 100  0    0   1    1
. 4   18 100  0    0   1    1</code></pre>
</div>
<div id="ev_rep" class="section level3" number="4.6.3">
<h3>
<span class="header-section-number">4.6.3</span> ev_rep<a class="anchor" aria-label="anchor" href="#ev_rep"><i class="fas fa-link"></i></a>
</h3>
<p>Event objects can be “expanded” into multiple IDs to create a population;
use the <code>ev_rep()</code> function for this.</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ev_rep</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID time amt cmt evid
. 1  1    0 100   1    1
. 2  2    0 100   1    1
. 3  3    0 100   1    1
. 4  4    0 100   1    1
. 5  5    0 100   1    1</code></pre>
<p>By default, <code>ev_rep()</code> returns a regular data frame. You can request that
an event object is returned</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ev_rep</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, as.ev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><code>ev_rep()</code> can work on an event object with any complexity.</p>
</div>
</div>
<div id="creative-composition" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> Creative composition<a class="anchor" aria-label="anchor" href="#creative-composition"><i class="fas fa-link"></i></a>
</h2>
<p>mrgsolve has a couple of more creative ways to construct event objects.</p>
<div id="ev_days" class="section level3" number="4.7.1">
<h3>
<span class="header-section-number">4.7.1</span> ev_days<a class="anchor" aria-label="anchor" href="#ev_days"><i class="fas fa-link"></i></a>
</h3>
<p><code>ev_days()</code> will create dosing sequences when dosing are on certain days (of the
week). For example, to dose only on Monday, Wednesday, and Friday for on month</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu">ev_days</span><span class="op">(</span><span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, ii <span class="op">=</span> <span class="fl">168</span>, addl <span class="op">=</span> <span class="fl">3</span>, days <span class="op">=</span> <span class="st">'m,w,f'</span><span class="op">)</span>
<span class="va">e</span></code></pre></div>
<pre><code>.   time amt cmt evid  ii addl
. 1    0 100   1    1 168    3
. 2   48 100   1    1 168    3
. 3   96 100   1    1 168    3</code></pre>
<p>We can see how this works by simulating the regimen</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mrgsim_e</span><span class="op">(</span><span class="va">mod</span>, <span class="va">e</span>, end <span class="op">=</span> <span class="fl">168</span><span class="op">*</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="st">"CP"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="user-guide_files/figure-html/unnamed-chunk-156-1.png" width="672"></div>
</div>
<div id="ev_rx" class="section level3" number="4.7.2">
<h3>
<span class="header-section-number">4.7.2</span> ev_rx<a class="anchor" aria-label="anchor" href="#ev_rx"><i class="fas fa-link"></i></a>
</h3>
<p><code>ev_rx()</code> is a way to write a regimen out with notation similar to what you
might see on a prescription. For example, 100 mg twice daily for 3 doses into
compartment 2 would be</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev_rx</span><span class="op">(</span><span class="st">"100 mg q12h x3 in 2"</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt ii addl cmt evid
. 1    0 100 12    2   2    1</code></pre>
<p>To code an infusion</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ev_rx</span><span class="op">(</span><span class="st">"500 mg over 2 hours q 24 h x3 in 1"</span><span class="op">)</span></code></pre></div>
<pre><code>. Events:
.   time amt rate ii addl cmt evid
. 1    0 500  250 24    2   1    1</code></pre>
<p>See the <code>ev_rx()</code> documentation for more details and limitations.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></div>
<div class="next"><a href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#event-chapter"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="nav-link" href="#usage"><span class="header-section-number">4.1</span> Usage</a></li>
<li><a class="nav-link" href="#construction"><span class="header-section-number">4.2</span> Construction</a></li>
<li><a class="nav-link" href="#coerce-to-data-set"><span class="header-section-number">4.3</span> Coerce to data set</a></li>
<li><a class="nav-link" href="#extract-information"><span class="header-section-number">4.4</span> Extract information</a></li>
<li>
<a class="nav-link" href="#combining-event-objects"><span class="header-section-number">4.5</span> Combining event objects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#concatenate"><span class="header-section-number">4.5.1</span> Concatenate</a></li>
<li><a class="nav-link" href="#sequence"><span class="header-section-number">4.5.2</span> Sequence</a></li>
<li><a class="nav-link" href="#repeat"><span class="header-section-number">4.5.3</span> repeat</a></li>
<li><a class="nav-link" href="#create-a-data_set"><span class="header-section-number">4.5.4</span> Create a “data_set”</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#modifying-an-event-object"><span class="header-section-number">4.6</span> Modifying an event object</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy-like-manipulation"><span class="header-section-number">4.6.1</span> Tidy-like manipulation</a></li>
<li><a class="nav-link" href="#realize_addl"><span class="header-section-number">4.6.2</span> realize_addl</a></li>
<li><a class="nav-link" href="#ev_rep"><span class="header-section-number">4.6.3</span> ev_rep</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#creative-composition"><span class="header-section-number">4.7</span> Creative composition</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ev_days"><span class="header-section-number">4.7.1</span> ev_days</a></li>
<li><a class="nav-link" href="#ev_rx"><span class="header-section-number">4.7.2</span> ev_rx</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mrgsolve User Guide</strong>" was written by <font color="DarkGreen">Metrum Research Group</font>. It was last built on 2022-03-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
