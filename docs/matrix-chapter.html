<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Model Matrices | mrgsolve User Guide</title>
<meta name="author" content="Metrum Research Group">
<meta name="description" content="Model matrices include $OMEGA (for subject-level variability) and $SIGMA (for residual unexplained variability). These matrices are coded into the model file (see Sections 2.2.16 and 2.2.17) and...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 5 Model Matrices | mrgsolve User Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mrgsolve.github.io/user_guide/matrix-chapter.html">
<meta property="og:description" content="Model matrices include $OMEGA (for subject-level variability) and $SIGMA (for residual unexplained variability). These matrices are coded into the model file (see Sections 2.2.16 and 2.2.17) and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Model Matrices | mrgsolve User Guide">
<meta name="twitter:site" content="@mrgsolve">
<meta name="twitter:description" content="Model matrices include $OMEGA (for subject-level variability) and $SIGMA (for residual unexplained variability). These matrices are coded into the model file (see Sections 2.2.16 and 2.2.17) and...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bookstyle.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mrgsolve User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="model-components.html"><span class="header-section-number">1</span> Model components</a></li>
<li><a class="" href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></li>
<li><a class="" href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="" href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="active" href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></li>
<li><a class="" href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></li>
<li><a class="" href="section-sequence.html"><span class="header-section-number">7</span> Simulation sequence</a></li>
<li><a class="" href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></li>
<li><a class="" href="plugins.html"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="" href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="" href="topics.html"><span class="header-section-number">11</span> Topics</a></li>
<li><a class="" href="q-and-a.html"><span class="header-section-number">12</span> Questions and Answers</a></li>
<li><a class="" href="install.html"><span class="header-section-number">13</span> Installation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="matrix-chapter" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Model Matrices<a class="anchor" aria-label="anchor" href="#matrix-chapter"><i class="fas fa-link"></i></a>
</h1>
<p>Model matrices include <code>$OMEGA</code> (for subject-level variability) and <code>$SIGMA</code>
(for residual unexplained variability). These matrices are coded into the
model file (see Sections <a href="model-specification.html#block-omega">2.2.16</a> and <a href="model-specification.html#block-sigma">2.2.17</a>) and can
be manipulated in different ways via the model object. Because, <code>$OMEGA</code> and
<code>$SIGMA</code> matrices are handled using identical approach (only the names of the
functions change), we will focus on working with <code>$OMEGA</code> in the following
examples with references to the equivalent functions that can be used to
work on <code>$SIGMA</code>. Also note that, for simplicity, we will not compile the
examples presented in this chapter.</p>
<div id="basics" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Basics<a class="anchor" aria-label="anchor" href="#basics"><i class="fas fa-link"></i></a>
</h2>
<div id="simple-matrix-lists" class="section level3" number="5.1.1">
<h3>
<span class="header-section-number">5.1.1</span> Simple matrix lists<a class="anchor" aria-label="anchor" href="#simple-matrix-lists"><i class="fas fa-link"></i></a>
</h3>
<p>We can look at the <code>popex</code> model in the internal library for a starting example
to show how model matrices can be seen from the model object.</p>
<p>Once the model is loaded</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">modlib</span><span class="op">(</span><span class="st">"popex"</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We can print the model object to the console and see the matrix structure</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span></code></pre></div>
<pre><code>. 
. 
. ----------------  source: popex.cpp  ----------------
. 
.   project: /Users/kyleb/Rli...gsolve/models
.   shared object: popex-so-e41611940d1e &lt;not loaded&gt;
. 
.   time:          start: 0 end: 240 delta: 0.5
.                  add: &lt;none&gt;
. 
.   compartments:  GUT CENT [2]
.   parameters:    TVKA TVCL TVV WT [4]
.   captures:      CL V ECL IPRED DV [5]
.   omega:         3x3 
.   sigma:         1x1 
. 
.   solver:        atol: 1e-08 rtol: 1e-08 maxsteps: 20k
. ------------------------------------------------------</code></pre>
<p>In this output, we see that <code>omega</code> is a 3 by 3 matrix and <code>sigma</code> is 1 by 1.
We can view both matrices by calling <code>revar()</code> on the model object</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">revar</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. $omega
. $...
.       [,1] [,2] [,3]
. ECL:   0.3  0.0  0.0
. EV:    0.0  0.1  0.0
. EKA:   0.0  0.0  0.5
. 
. 
. $sigma
. $...
.     [,1]
. 1:     0</code></pre>
<p>This shows the 3x3 <code>$OMEGA</code> matrix with all off-diagonals set to zero and the
1x1 <code>$SIGMA</code> which is currently fixed to 0.</p>
<p>The <code>$OMEGA</code> matrix can be extracted with the <code>omat()</code> function</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. $...
.       [,1] [,2] [,3]
. ECL:   0.3  0.0  0.0
. EV:    0.0  0.1  0.0
. EKA:   0.0  0.0  0.5</code></pre>
<p>Use the <code>smat()</code> function to extract the <code>$SIGMA</code> matrix. The result of these
calls are <code>matlist</code> objects; for <code>$OMEGA</code> the class is <code>omegalist</code> (which
inherits from <code>matlist</code>)</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "omegalist"
. attr(,"package")
. [1] "mrgsolve"</code></pre>
<p>and for <code>$SIGMA</code> it is <code>sigmalist</code>. These are lists of matrices. In this
example, there is just one <code>$OMEGA</code> block in the code</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">blocks</span><span class="op">(</span><span class="va">mod</span>, <span class="va">OMEGA</span><span class="op">)</span></code></pre></div>
<pre><code>. 
. Model file: popex.cpp 
. 
. $OMEGA
. @labels ECL EV EKA
. 0.3 0.1 0.5</code></pre>
<p>so the length of the <code>omegalist</code> object is also 1</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">om</span> <span class="op">&lt;-</span> <span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 1</code></pre>
<p>Functions are provided to check the names</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] "..."</code></pre>
<p>and the labels</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>. [[1]]
. [1] "ECL" "EV"  "EKA"</code></pre>
<p>as well as getting the dimensions or number of rows</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>. $...
. [1] 3 3</code></pre>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>. ... 
.   3</code></pre>
<p>The <code>omegalist</code> (<code>sigmalist</code>) object can be converted to a standard R list</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. List of 1
.  $ ...: num [1:3, 1:3] 0.3 0 0 0 0.1 0 0 0 0.5
.   ..- attr(*, "dimnames")=List of 2
.   .. ..$ : chr [1:3] "ECL" "EV" "EKA"
.   .. ..$ : chr [1:3] "ECL" "EV" "EKA"</code></pre>
<p>or it can be rendered as a matrix</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">om</span><span class="op">)</span></code></pre></div>
<pre><code>.      [,1] [,2] [,3]
. [1,]  0.3  0.0  0.0
. [2,]  0.0  0.1  0.0
. [3,]  0.0  0.0  0.5</code></pre>
</div>
<div id="multiple-matrix-lists" class="section level3" number="5.1.2">
<h3>
<span class="header-section-number">5.1.2</span> Multiple matrix lists<a class="anchor" aria-label="anchor" href="#multiple-matrix-lists"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s look at an example where there is a more complicated <code>$OMEGA</code> structure.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'
$OMEGA @name first @labels a b c
1 2 3

$OMEGA @name second @labels d e
4 5

$OMEGA @name third @labels f g h i
6 7 8 9
'</span>
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"multiple-matrices"</span>, <span class="va">code</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Each <code>$OMEGA</code> block codes a diagonal matrix; the interesting feature is that
there are 3 different <code>$OMEGA</code> blocks.</p>
<p>Now, when we look at the model</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span></code></pre></div>
<pre><code>. 
. 
. ----------  source: multiple-matrices.cpp  ----------
. 
.   project: /private/var/fol.../T/RtmpxbKKp1
.   shared object: multiple-matrices-so-e4161e84987b &lt;not loaded&gt;
. 
.   time:          start: 0 end: 24 delta: 1
.                  add: &lt;none&gt;
. 
.   compartments:  &lt;none&gt;
.   parameters:    &lt;none&gt;
.   captures:       &lt;none&gt;
.   omega:         3x3,2x2,4x4 
.   sigma:         0x0 
. 
.   solver:        atol: 1e-08 rtol: 1e-08 maxsteps: 20k
. ------------------------------------------------------</code></pre>
<p>We see that <code>$OMEGA</code> is one 3x3 matrix, one 2x2 matrix and on 4x4 matrix, in
that order. Calling <code>revar()</code> on this model object</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">revar</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. $omega
. $first
.     [,1] [,2] [,3]
. a:     1    0    0
. b:     0    2    0
. c:     0    0    3
. 
. $second
.     [,1] [,2]
. d:     4    0
. e:     0    5
. 
. $third
.     [,1] [,2] [,3] [,4]
. f:     6    0    0    0
. g:     0    7    0    0
. h:     0    0    8    0
. i:     0    0    0    9
. 
. 
. $sigma
. No matrices found</code></pre>
<p>we only see the <code>$OMEGA</code> matrices as the model was coded. Now the length
of the <code>omegalist</code> object is 3</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 3</code></pre>
<p>and the number of rows is 3 in the first matrix, 2 in the second, and 4 in the
third</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>.  first second  third 
.      3      2      4</code></pre>
<p>We can also check <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code></p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. $first
. [1] 3 3
. 
. $second
. [1] 2 2
. 
. $third
. [1] 4 4</code></pre>
<p>The omega matrix can be converted from this segmented list into a single block
matrix</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>.       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
.  [1,]    1    0    0    0    0    0    0    0    0
.  [2,]    0    2    0    0    0    0    0    0    0
.  [3,]    0    0    3    0    0    0    0    0    0
.  [4,]    0    0    0    4    0    0    0    0    0
.  [5,]    0    0    0    0    5    0    0    0    0
.  [6,]    0    0    0    0    0    6    0    0    0
.  [7,]    0    0    0    0    0    0    7    0    0
.  [8,]    0    0    0    0    0    0    0    8    0
.  [9,]    0    0    0    0    0    0    0    0    9</code></pre>
<p>The result is 9x9 with all off diagonals between the different list positions
set to zero.</p>
<p>Otherwise, we might work with this object as a list</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. $first
.   a b c
. a 1 0 0
. b 0 2 0
. c 0 0 3
. 
. $second
.   d e
. d 4 0
. e 0 5
. 
. $third
.   f g h i
. f 6 0 0 0
. g 0 7 0 0
. h 0 0 8 0
. i 0 0 0 9</code></pre>
</div>
</div>
<div id="collapsing-matrices" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Collapsing matrices<a class="anchor" aria-label="anchor" href="#collapsing-matrices"><i class="fas fa-link"></i></a>
</h2>
<p>The functionality described in this subsection is new with mrgsolve 1.0.0.</p>
<p>The structure of the matrices and the order in which they appear in the list
matter when updating each matrix (see below). We saw how to create one big
matrix out of all the smaller matrices using the <code><a href="https://rdrr.io/r/base/matrix.html">as.matrix()</a></code>. This section
describes how to combine matrices within the confines of the <code>matlist</code> object.</p>
<p>mrgsolve provides functions to collapse (or combine) matrices in a <code>matlist</code>
object. We can call <code>collapse_omega()</code>, passing in the model object</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">collapse_omega</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">revar</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. $omega
. $...
.     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
. a:     1    0    0    0    0    0    0    0    0
. b:     0    2    0    0    0    0    0    0    0
. c:     0    0    3    0    0    0    0    0    0
. d:     0    0    0    4    0    0    0    0    0
. e:     0    0    0    0    5    0    0    0    0
. f:     0    0    0    0    0    6    0    0    0
. g:     0    0    0    0    0    0    7    0    0
. h:     0    0    0    0    0    0    0    8    0
. i:     0    0    0    0    0    0    0    0    9
. 
. 
. $sigma
. No matrices found</code></pre>
<p>and now we have an <code>omegalist</code> object inside a model object and the matrix
is a single 9x9 <code>$OMEGA</code> matrix. The row names have been retained, but there
is now no name for the matrix; this can be provided when collapsing</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">collapse_omega</span><span class="op">(</span><span class="va">mod</span>, name <span class="op">=</span> <span class="st">"only"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. $only
.     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
. a:     1    0    0    0    0    0    0    0    0
. b:     0    2    0    0    0    0    0    0    0
. c:     0    0    3    0    0    0    0    0    0
. d:     0    0    0    4    0    0    0    0    0
. e:     0    0    0    0    5    0    0    0    0
. f:     0    0    0    0    0    6    0    0    0
. g:     0    0    0    0    0    0    7    0    0
. h:     0    0    0    0    0    0    0    8    0
. i:     0    0    0    0    0    0    0    0    9</code></pre>
<p>Suppose that we only want to combine the first two matrices, leaving the third
matrix alone. In that case, call <code>collapse_omega()</code> with the range argument</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">collapse_omega</span><span class="op">(</span><span class="va">mod</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"first_second"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. $first_second
.     [,1] [,2] [,3] [,4] [,5]
. a:     1    0    0    0    0
. b:     0    2    0    0    0
. c:     0    0    3    0    0
. d:     0    0    0    4    0
. e:     0    0    0    0    5
. 
. $third
.     f g h i
. f:  6 0 0 0
. g:  0 7 0 0
. h:  0 0 8 0
. i:  0 0 0 9</code></pre>
<p>Now the matlist topology has changed; there are still 9 (total) rows and columns,
but the matlist object is length 2 with 5x5 in the first position (newly
named <code>first_second</code>) an the old 4x4 matrix in the second position. Collapsing
matrices is an irreversible process; at this time there is no mechanism to
cut matrices back into smaller chunks. But collapsing matrices can be very helpful
when they need to be updated.</p>
<p>Use <code>collapse_sigma()</code> to collapse <code>$SIGMA</code> matrices if needed.</p>
<p>Also, the function <code>collapse_matrix()</code> can be called on a <code>omegalist</code> or
<code>sigmalist</code> object to collapse</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">collapse_matrix</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="cn">NA</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. $first
.     a b c
. a:  1 0 0
. b:  0 2 0
. c:  0 0 3
. 
. $...
.     [,1] [,2] [,3] [,4] [,5] [,6]
. d:     4    0    0    0    0    0
. e:     0    5    0    0    0    0
. f:     0    0    6    0    0    0
. g:     0    0    0    7    0    0
. h:     0    0    0    0    8    0
. i:     0    0    0    0    0    9</code></pre>
</div>
<div id="matrix-update" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  <a class="anchor" aria-label="anchor" href="#matrix-update"><i class="fas fa-link"></i></a>
</h2>
<p>Like the values of parameters in the parameter list, we may want to update the
values in <code>$OMEGA</code> and <code>$SIGMA</code> matrices. We can do so without re-compiling the
model.</p>
<div id="matrix-helper-functions" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Matrix helper functions<a class="anchor" aria-label="anchor" href="#matrix-helper-functions"><i class="fas fa-link"></i></a>
</h3>
<p><code>mrgsolve</code> keeps <code>$OMEGA</code> and <code>$SIGMA</code> in block matrices (regardless of whether
the off-diagonal elements are zeros or not). Recall that in the model
specification file we can enter data for <code>$OMEGA</code> and <code>$SIGMA</code> as the lower
triangle of the matrix (see section <a href="model-specification.html#block-omega">2.2.16</a>). In <code>R</code>, we need to
provide a matrix (as an <code>R</code> object). <code>mrgsolve</code> provides some convenience
functions to help … allowing the user to enter lower diagonals instead of the
full matrix.</p>
<p><code>dmat()</code> for diagonal matrix</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dmat</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>.      [,1] [,2] [,3]
. [1,]    1    0    0
. [2,]    0    2    0
. [3,]    0    0    3</code></pre>
<p><code>bmat()</code> for block matrix</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bmat</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>.      [,1] [,2]
. [1,]    1    2
. [2,]    2    3</code></pre>
<p><code>cmat()</code> for a block matrix where the diagonal elements are variances and the
off-diagonals are taken to be correlations, not covariances</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">cmat</span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.87</span>,<span class="fl">0.3</span><span class="op">)</span></code></pre></div>
<pre><code>.           [,1]      [,2]
. [1,] 0.1000000 0.1506884
. [2,] 0.1506884 0.3000000</code></pre>
<p><code>mrgsolve</code> will convert the correlations to covariances.</p>
<p><code>mrgsolve</code> also provides <code>as_bmat()</code> and <code>as_dmat()</code> for converting other <code>R</code>
objects to matrices or lists of matrices.</p>
<p>Consider this list with named elements holding the data for a matrix:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>OMEGA1.1 <span class="op">=</span> <span class="fl">0.9</span>, OMEGA2.1 <span class="op">=</span> <span class="fl">0.3</span>, OMEGA2.2 <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></code></pre></div>
<p>These data could form either a 3x3 diagonal matrix or a 2x2 block matrix. But
the names suggest a 2x2 form. <code>as_bmat()</code> can make the matrix like this</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">as_bmat</span><span class="op">(</span><span class="va">m</span>, <span class="st">"OMEGA"</span><span class="op">)</span></code></pre></div>
<pre><code>.      [,1] [,2]
. [1,]  0.9  0.3
. [2,]  0.3  0.4</code></pre>
<p>The second argument is a regular expression that <code>mrgsolve</code> uses to find
elements in the list to use for building the matrix.</p>
<p>Frequently, we have estimates in a data frame like this</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exBoot</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">exBoot</span><span class="op">)</span></code></pre></div>
<pre><code>.   run  THETA1 THETA2  THETA3 OMEGA11   OMEGA21 OMEGA22 OMEGA31  OMEGA32 OMEGA33
. 1   1 -0.7634  2.280  0.8472 0.12860  0.046130  0.2874 0.13820 -0.02164  0.3933
. 2   2 -0.4816  2.076  0.5355 0.12000  0.051000  0.2409 0.06754 -0.07759  0.3342
. 3   3 -0.5865  2.334 -0.4597 0.11460  0.097150  0.2130 0.16650  0.18100  0.4699
. 4   4 -0.6881  1.824  0.7736 0.14990  0.000003  0.2738 0.24700 -0.05466  0.5536
. 5   5  0.2909  1.519 -1.2440 0.07308  0.003842  0.2989 0.06475  0.05078  0.2500
. 6   6  0.1135  2.144 -1.0040 0.13390 -0.019270  0.1640 0.10740 -0.01170  0.3412
.    SIGMA11 SIGMA21 SIGMA22
. 1 0.002579       0  1.0300
. 2 0.002228       0  1.0050
. 3 0.002418       0  1.0890
. 4 0.002177       0  0.8684
. 5 0.001606       0  0.8996
. 6 0.002134       0  0.9744</code></pre>
<p>We can use <code>as_bmat()</code> with this data frame to extract the <code>$OMEGA</code> matrices</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omegas</span> <span class="op">&lt;-</span> <span class="fu">as_bmat</span><span class="op">(</span><span class="va">exBoot</span>, <span class="st">"OMEGA"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">omegas</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 100</code></pre>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">exBoot</span><span class="op">)</span></code></pre></div>
<pre><code>. [1] 100  13</code></pre>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omegas</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>.          [,1]     [,2]    [,3]
. [1,]  0.13390 -0.01927  0.1074
. [2,] -0.01927  0.16400 -0.0117
. [3,]  0.10740 -0.01170  0.3412</code></pre>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omegas</span><span class="op">[[</span><span class="fl">16</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>.         [,1]    [,2]   [,3]
. [1,] 0.08126 0.01252 0.1050
. [2,] 0.01252 0.16860 0.0149
. [3,] 0.10500 0.01490 0.4062</code></pre>
<p>The result of calling <code>as_bmat</code> or <code>as_dmat</code> is a list of matrices, one for
each row in the data frame.</p>
<p>Note in this example, we could have called</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sigmas</span> <span class="op">&lt;-</span> <span class="fu">as_bmat</span><span class="op">(</span><span class="va">exBoot</span>,<span class="st">"SIGMA"</span><span class="op">)</span> </code></pre></div>
<p>to grab the <code>$SIGMA</code> matrices.</p>
<p>For help on these helper functions, see <code>?dmat</code>, <code>?bmat</code>, <code>?cmat</code>, <code>?as_bmat</code>,
<code>?as_dmat</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
</div>
<div id="fill-a-matrix-with-zeros" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Fill a matrix with zeros<a class="anchor" aria-label="anchor" href="#fill-a-matrix-with-zeros"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes we write a population model that includes random effects, but we would
like to simulate from that same model without the random effects implemented.
For example, we want to simulate some typical PK profiles from a population PK
model that includes IIV on some parameters and / or RUV on the simulated
outputs.</p>
<p>To do this, pass the model through the <code>zero_re()</code> function. By default, this
will convert all <code>$OMEGA</code> and <code>$SIGMA</code> matrix elements to zeros. See the R help
file (<code>?zero_re</code>) to see some options for selectively zeroing out only one or
the other.</p>
<p>For example we have this population PK model</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">modlib</span><span class="op">(</span><span class="st">"popex"</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">omat</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. $...
.       [,1] [,2] [,3]
. ECL:   0.3  0.0  0.0
. EV:    0.0  0.1  0.0
. EKA:   0.0  0.0  0.5</code></pre>
<p>We can turn that matrix to all zeros with</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">zero_re</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. $...
.       [,1] [,2] [,3]
. ECL:     0    0    0
. EV:      0    0    0
. EKA:     0    0    0</code></pre>
<p>And when we simulate right after that, all <code>ETA(n)</code> will be zero as well
and you’ll get your fixed-effects simulation (the following is for example
only and is not evaluated)</p>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> 
  <span class="fu">zero_re</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ev</span><span class="op">(</span>amt <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mrgsim</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-unnamed-matrix" class="section level3" number="5.3.3">
<h3>
<span class="header-section-number">5.3.3</span> Example: unnamed matrix<a class="anchor" aria-label="anchor" href="#example-unnamed-matrix"><i class="fas fa-link"></i></a>
</h3>
<p>Here is a model with only a 3x3 <code>$OMEGA</code> matrix</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'
$OMEGA
1 2 3
'</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"matrix"</span>, <span class="va">code</span>, compile<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Let’s check the values in the matrix using <code>omat()</code></p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="va">omat</span></code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     1    0    0
. 2:     0    2    0
. 3:     0    0    3</code></pre>
<p>We also use <code>omat()</code> to update the values in the matrix</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="fu">dmat</span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">omat</span></code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     4    0    0
. 2:     0    5    0
. 3:     0    0    6</code></pre>
<p>To update <code>$OMEGA</code>, we must provide a matrix of the same dimension, in this
case 3x3. An error is generated if we provide a matrix with the wrong dimension.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ans</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="fu">dmat</span><span class="op">(</span><span class="fl">11</span>,<span class="fl">23</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. Error : improper signature: omat</code></pre>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ans</span></code></pre></div>
<pre><code>. [1] "Error : improper signature: omat\n"
. attr(,"class")
. [1] "try-error"
. attr(,"condition")
. &lt;simpleError: improper signature: omat&gt;</code></pre>
</div>
<div id="example-named-matrices" class="section level3" number="5.3.4">
<h3>
<span class="header-section-number">5.3.4</span> Example: named matrices<a class="anchor" aria-label="anchor" href="#example-named-matrices"><i class="fas fa-link"></i></a>
</h3>
<p>When there are multiple <code>$OMEGA</code> matrices, it can be helpful to assign them
names. Here, there are two matrices: one for interindividual variability
(<code>IIV</code>) and one for interoccasion variability (<code>IOV</code>).</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'
$OMEGA @name IIV
1 2 3
$OMEGA @name IOV
4 5
'</span>
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"iov"</span>, <span class="va">code</span>, compile<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">revar</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>. $omega
. $IIV
.     [,1] [,2] [,3]
. 1:     1    0    0
. 2:     0    2    0
. 3:     0    0    3
. 
. $IOV
.     [,1] [,2]
. 4:     4    0
. 5:     0    5
. 
. 
. $sigma
. No matrices found</code></pre>
<p>Now, we can update either <code>IIV</code> or <code>IOV</code> (or both) by name</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> 
  <span class="fu">omat</span><span class="op">(</span>IOV <span class="op">=</span> <span class="fu">dmat</span><span class="op">(</span><span class="fl">11</span>,<span class="fl">12</span><span class="op">)</span>, IIV <span class="op">=</span> <span class="fu">dmat</span><span class="op">(</span><span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="va">omat</span></code></pre></div>
<pre><code>. $IIV
.     [,1] [,2] [,3]
. 1:    13    0    0
. 2:     0   14    0
. 3:     0    0   15
. 
. $IOV
.     [,1] [,2]
. 4:    11    0
. 5:     0   12</code></pre>
<p>Again, an error is generated if we try to assign a 3x3 matrix to the <code>IOV</code>
position</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ans</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span>IIV <span class="op">=</span> <span class="fu">dmat</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>. Error : improper dimension: omat</code></pre>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ans</span></code></pre></div>
<pre><code>. [1] "Error : improper dimension: omat\n"
. attr(,"class")
. [1] "try-error"
. attr(,"condition")
. &lt;simpleError: improper dimension: omat&gt;</code></pre>
</div>
<div id="example-unnamed-matrices" class="section level3" number="5.3.5">
<h3>
<span class="header-section-number">5.3.5</span> Example: unnamed matrices<a class="anchor" aria-label="anchor" href="#example-unnamed-matrices"><i class="fas fa-link"></i></a>
</h3>
<p>If we do write the model with unnamed matrices, we can still update them</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">code</span> <span class="op">&lt;-</span> <span class="st">'
$OMEGA
1 2 3

$OMEGA 
4 5
'</span>
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mcode</span><span class="op">(</span><span class="st">"multi"</span>, <span class="va">code</span>, compile <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>In this case, the only way to update is to pass in a <strong>list</strong> of matrices, where
(in this example) the first matrix is 3x3 and the second is 2x2</p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">dmat</span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu">dmat</span><span class="op">(</span><span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">omat</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>. $...
.     [,1] [,2] [,3]
. 1:     5    0    0
. 2:     0    6    0
. 3:     0    0    7
. 
. $...
.     [,1] [,2]
. 4:     8    0
. 5:     0    9</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></div>
<div class="next"><a href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#matrix-chapter"><span class="header-section-number">5</span> Model Matrices</a></li>
<li>
<a class="nav-link" href="#basics"><span class="header-section-number">5.1</span> Basics</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-matrix-lists"><span class="header-section-number">5.1.1</span> Simple matrix lists</a></li>
<li><a class="nav-link" href="#multiple-matrix-lists"><span class="header-section-number">5.1.2</span> Multiple matrix lists</a></li>
</ul>
</li>
<li><a class="nav-link" href="#collapsing-matrices"><span class="header-section-number">5.2</span> Collapsing matrices</a></li>
<li>
<a class="nav-link" href="#matrix-update"><span class="header-section-number">5.3</span> Updating $OMEGA and $SIGMA  </a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#matrix-helper-functions"><span class="header-section-number">5.3.1</span> Matrix helper functions</a></li>
<li><a class="nav-link" href="#fill-a-matrix-with-zeros"><span class="header-section-number">5.3.2</span> Fill a matrix with zeros</a></li>
<li><a class="nav-link" href="#example-unnamed-matrix"><span class="header-section-number">5.3.3</span> Example: unnamed matrix</a></li>
<li><a class="nav-link" href="#example-named-matrices"><span class="header-section-number">5.3.4</span> Example: named matrices</a></li>
<li><a class="nav-link" href="#example-unnamed-matrices"><span class="header-section-number">5.3.5</span> Example: unnamed matrices</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mrgsolve User Guide</strong>" was written by Metrum Research Group. It was last built on 2022-06-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
