<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>mrgsolve User Guide</title>
  <meta name="description" content="A guide to using mrgsolve.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="mrgsolve User Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to using mrgsolve." />
  <meta name="github-repo" content="metrumresearchgroup/mrgsolve" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="mrgsolve User Guide" />
  
  <meta name="twitter:description" content="A guide to using mrgsolve." />
  

<meta name="author" content="Metrum Research Group, LLC">


<meta name="date" content="2018-03-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="model-specification.html">
<link rel="next" href="simulated-output.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">User Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> mrgsolve User Guide</a></li>
<li class="chapter" data-level="2" data-path="model-components.html"><a href="model-components.html"><i class="fa fa-check"></i><b>2</b> Model components</a><ul>
<li class="chapter" data-level="2.1" data-path="model-components.html"><a href="model-components.html#component-param"><i class="fa fa-check"></i><b>2.1</b> Parameter list</a><ul>
<li class="chapter" data-level="2.1.1" data-path="model-components.html"><a href="model-components.html#central-role-of-parameters-in-planning-simulations"><i class="fa fa-check"></i><b>2.1.1</b> Central role of parameters in planning simulations</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="model-components.html"><a href="model-components.html#component-init"><i class="fa fa-check"></i><b>2.2</b> Compartment list</a></li>
<li class="chapter" data-level="2.3" data-path="model-components.html"><a href="model-components.html#component-stime"><i class="fa fa-check"></i><b>2.3</b> Simulation time grid</a><ul>
<li class="chapter" data-level="2.3.1" data-path="model-components.html"><a href="model-components.html#component-tgrid"><i class="fa fa-check"></i><b>2.3.1</b> <code>tgrid</code> objects</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-components.html"><a href="model-components.html#solver-settings"><i class="fa fa-check"></i><b>2.4</b> Solver settings</a></li>
<li class="chapter" data-level="2.5" data-path="model-components.html"><a href="model-components.html#functions"><i class="fa fa-check"></i><b>2.5</b> Functions</a><ul>
<li class="chapter" data-level="2.5.1" data-path="model-components.html"><a href="model-components.html#the-main-function"><i class="fa fa-check"></i><b>2.5.1</b> The <code>$MAIN</code> function</a></li>
<li class="chapter" data-level="2.5.2" data-path="model-components.html"><a href="model-components.html#the-ode-function"><i class="fa fa-check"></i><b>2.5.2</b> The <code>$ODE</code> function</a></li>
<li class="chapter" data-level="2.5.3" data-path="model-components.html"><a href="model-components.html#the-table-function"><i class="fa fa-check"></i><b>2.5.3</b> The <code>$TABLE</code> function</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="model-components.html"><a href="model-components.html#random-effect-variances"><i class="fa fa-check"></i><b>2.6</b> Random effect variances</a><ul>
<li class="chapter" data-level="2.6.1" data-path="model-components.html"><a href="model-components.html#omega"><i class="fa fa-check"></i><b>2.6.1</b> <code>OMEGA</code></a></li>
<li class="chapter" data-level="2.6.2" data-path="model-components.html"><a href="model-components.html#sigma"><i class="fa fa-check"></i><b>2.6.2</b> <code>SIGMA</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-specification.html"><a href="model-specification.html"><i class="fa fa-check"></i><b>3</b> Model specification</a><ul>
<li class="chapter" data-level="3.1" data-path="model-specification.html"><a href="model-specification.html#how-where-to-write-a-model"><i class="fa fa-check"></i><b>3.1</b> How / where to write a model</a><ul>
<li class="chapter" data-level="3.1.1" data-path="model-specification.html"><a href="model-specification.html#spec-separate-file"><i class="fa fa-check"></i><b>3.1.1</b> Separate file</a></li>
<li class="chapter" data-level="3.1.2" data-path="model-specification.html"><a href="model-specification.html#spec-inline"><i class="fa fa-check"></i><b>3.1.2</b> Inline / <code>code</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="model-specification.html"><a href="model-specification.html#code-blocks"><i class="fa fa-check"></i><b>3.2</b> Code blocks</a><ul>
<li class="chapter" data-level="3.2.1" data-path="model-specification.html"><a href="model-specification.html#about-code-blocks"><i class="fa fa-check"></i><b>3.2.1</b> About code blocks</a></li>
<li class="chapter" data-level="3.2.2" data-path="model-specification.html"><a href="model-specification.html#block-param"><i class="fa fa-check"></i><b>3.2.2</b> <code>$PARAM</code>  </a></li>
<li class="chapter" data-level="3.2.3" data-path="model-specification.html"><a href="model-specification.html#block-fixed"><i class="fa fa-check"></i><b>3.2.3</b> <code>$FIXED</code>  </a></li>
<li class="chapter" data-level="3.2.4" data-path="model-specification.html"><a href="model-specification.html#cmt-and-init"><i class="fa fa-check"></i><b>3.2.4</b> <code>$CMT</code> and <code>$INIT</code></a></li>
<li class="chapter" data-level="3.2.5" data-path="model-specification.html"><a href="model-specification.html#block-main"><i class="fa fa-check"></i><b>3.2.5</b> <code>$MAIN</code>  </a></li>
<li class="chapter" data-level="3.2.6" data-path="model-specification.html"><a href="model-specification.html#block-ode"><i class="fa fa-check"></i><b>3.2.6</b> <code>$ODE</code>  </a></li>
<li class="chapter" data-level="3.2.7" data-path="model-specification.html"><a href="model-specification.html#block-table"><i class="fa fa-check"></i><b>3.2.7</b> <code>$TABLE</code>  </a></li>
<li class="chapter" data-level="3.2.8" data-path="model-specification.html"><a href="model-specification.html#block-preamble"><i class="fa fa-check"></i><b>3.2.8</b> <code>$PREAMBLE</code>  </a></li>
<li class="chapter" data-level="3.2.9" data-path="model-specification.html"><a href="model-specification.html#block-capture"><i class="fa fa-check"></i><b>3.2.9</b> <code>$CAPTURE</code>  </a></li>
<li class="chapter" data-level="3.2.10" data-path="model-specification.html"><a href="model-specification.html#block-omega"><i class="fa fa-check"></i><b>3.2.10</b> <code>$OMEGA</code>  </a></li>
<li class="chapter" data-level="3.2.11" data-path="model-specification.html"><a href="model-specification.html#block-sigma"><i class="fa fa-check"></i><b>3.2.11</b> <code>$SIGMA</code>  </a></li>
<li class="chapter" data-level="3.2.12" data-path="model-specification.html"><a href="model-specification.html#set"><i class="fa fa-check"></i><b>3.2.12</b> <code>$SET</code></a></li>
<li class="chapter" data-level="3.2.13" data-path="model-specification.html"><a href="model-specification.html#global"><i class="fa fa-check"></i><b>3.2.13</b> <code>$GLOBAL</code></a></li>
<li class="chapter" data-level="3.2.14" data-path="model-specification.html"><a href="model-specification.html#pkmodel"><i class="fa fa-check"></i><b>3.2.14</b> <code>$PKMODEL</code></a></li>
<li class="chapter" data-level="3.2.15" data-path="model-specification.html"><a href="model-specification.html#block-plugin"><i class="fa fa-check"></i><b>3.2.15</b> <code>$PLUGIN</code>  </a></li>
<li class="chapter" data-level="3.2.16" data-path="model-specification.html"><a href="model-specification.html#block-theta"><i class="fa fa-check"></i><b>3.2.16</b> <code>$THETA</code>  </a></li>
<li class="chapter" data-level="3.2.17" data-path="model-specification.html"><a href="model-specification.html#block-nmxml"><i class="fa fa-check"></i><b>3.2.17</b> <code>$NMXML</code>  </a></li>
<li class="chapter" data-level="3.2.18" data-path="model-specification.html"><a href="model-specification.html#block-include"><i class="fa fa-check"></i><b>3.2.18</b> <code>$INCLUDE</code>  </a></li>
<li class="chapter" data-level="3.2.19" data-path="model-specification.html"><a href="model-specification.html#block-env"><i class="fa fa-check"></i><b>3.2.19</b> <code>$ENV</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="model-specification.html"><a href="model-specification.html#variables-and-macros"><i class="fa fa-check"></i><b>3.3</b> Variables and Macros</a><ul>
<li class="chapter" data-level="3.3.1" data-path="model-specification.html"><a href="model-specification.html#id"><i class="fa fa-check"></i><b>3.3.1</b> <code>ID</code></a></li>
<li class="chapter" data-level="3.3.2" data-path="model-specification.html"><a href="model-specification.html#time"><i class="fa fa-check"></i><b>3.3.2</b> <code>TIME</code></a></li>
<li class="chapter" data-level="3.3.3" data-path="model-specification.html"><a href="model-specification.html#solvertime"><i class="fa fa-check"></i><b>3.3.3</b> <code>SOLVERTIME</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="model-specification.html"><a href="model-specification.html#evid"><i class="fa fa-check"></i><b>3.3.4</b> <code>EVID</code></a></li>
<li class="chapter" data-level="3.3.5" data-path="model-specification.html"><a href="model-specification.html#newind"><i class="fa fa-check"></i><b>3.3.5</b> <code>NEWIND</code></a></li>
<li class="chapter" data-level="3.3.6" data-path="model-specification.html"><a href="model-specification.html#self.cmt"><i class="fa fa-check"></i><b>3.3.6</b> <code>self.cmt</code></a></li>
<li class="chapter" data-level="3.3.7" data-path="model-specification.html"><a href="model-specification.html#self.amt"><i class="fa fa-check"></i><b>3.3.7</b> <code>self.amt</code></a></li>
<li class="chapter" data-level="3.3.8" data-path="model-specification.html"><a href="model-specification.html#self.nid"><i class="fa fa-check"></i><b>3.3.8</b> <code>self.nid</code></a></li>
<li class="chapter" data-level="3.3.9" data-path="model-specification.html"><a href="model-specification.html#self.idn"><i class="fa fa-check"></i><b>3.3.9</b> <code>self.idn</code></a></li>
<li class="chapter" data-level="3.3.10" data-path="model-specification.html"><a href="model-specification.html#self.nrow"><i class="fa fa-check"></i><b>3.3.10</b> <code>self.nrow</code></a></li>
<li class="chapter" data-level="3.3.11" data-path="model-specification.html"><a href="model-specification.html#self.rown"><i class="fa fa-check"></i><b>3.3.11</b> <code>self.rown</code></a></li>
<li class="chapter" data-level="3.3.12" data-path="model-specification.html"><a href="model-specification.html#etan"><i class="fa fa-check"></i><b>3.3.12</b> <code>ETA(n)</code></a></li>
<li class="chapter" data-level="3.3.13" data-path="model-specification.html"><a href="model-specification.html#epsn"><i class="fa fa-check"></i><b>3.3.13</b> <code>EPS(n)</code></a></li>
<li class="chapter" data-level="3.3.14" data-path="model-specification.html"><a href="model-specification.html#tablename"><i class="fa fa-check"></i><b>3.3.14</b> <code>table(name)</code></a></li>
<li class="chapter" data-level="3.3.15" data-path="model-specification.html"><a href="model-specification.html#spec-f"><i class="fa fa-check"></i><b>3.3.15</b> <code>F_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.16" data-path="model-specification.html"><a href="model-specification.html#spec-alag"><i class="fa fa-check"></i><b>3.3.16</b> <code>ALAG_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.17" data-path="model-specification.html"><a href="model-specification.html#spec-r"><i class="fa fa-check"></i><b>3.3.17</b> <code>R_CMT</code>  </a></li>
<li class="chapter" data-level="3.3.18" data-path="model-specification.html"><a href="model-specification.html#spec-d"><i class="fa fa-check"></i><b>3.3.18</b> <code>D_CMT</code>  </a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="model-specification.html"><a href="model-specification.html#new-variables"><i class="fa fa-check"></i><b>3.4</b> Derive new variables</a></li>
<li class="chapter" data-level="3.5" data-path="model-specification.html"><a href="model-specification.html#examples"><i class="fa fa-check"></i><b>3.5</b> Examples</a><ul>
<li class="chapter" data-level="3.5.1" data-path="model-specification.html"><a href="model-specification.html#simple-pk-model"><i class="fa fa-check"></i><b>3.5.1</b> Simple PK model</a></li>
<li class="chapter" data-level="3.5.2" data-path="model-specification.html"><a href="model-specification.html#pkpd-model"><i class="fa fa-check"></i><b>3.5.2</b> PK/PD model</a></li>
<li class="chapter" data-level="3.5.3" data-path="model-specification.html"><a href="model-specification.html#population-pk-model-with-covariates-and-iov"><i class="fa fa-check"></i><b>3.5.3</b> Population PK model with covariates and IOV</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="input-data-sets.html"><a href="input-data-sets.html"><i class="fa fa-check"></i><b>4</b> Input data sets</a><ul>
<li class="chapter" data-level="4.1" data-path="input-data-sets.html"><a href="input-data-sets.html#datasets"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="input-data-sets.html"><a href="input-data-sets.html#data-set"><i class="fa fa-check"></i><b>4.2</b> Event data sets (<code>data</code>)</a><ul>
<li class="chapter" data-level="4.2.1" data-path="input-data-sets.html"><a href="input-data-sets.html#two-types-of-data_set"><i class="fa fa-check"></i><b>4.2.1</b> Two types of <code>data_set</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="input-data-sets.html"><a href="input-data-sets.html#sorting-requirements"><i class="fa fa-check"></i><b>4.2.2</b> Sorting requirements</a></li>
<li class="chapter" data-level="4.2.3" data-path="input-data-sets.html"><a href="input-data-sets.html#creating-data-sets"><i class="fa fa-check"></i><b>4.2.3</b> Creating data sets</a></li>
<li class="chapter" data-level="4.2.4" data-path="input-data-sets.html"><a href="input-data-sets.html#example"><i class="fa fa-check"></i><b>4.2.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="input-data-sets.html"><a href="input-data-sets.html#idata-set"><i class="fa fa-check"></i><b>4.3</b> Individual data sets (<code>idata</code>)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="input-data-sets.html"><a href="input-data-sets.html#use-case"><i class="fa fa-check"></i><b>4.3.1</b> Use case</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="input-data-sets.html"><a href="input-data-sets.html#numeric-only"><i class="fa fa-check"></i><b>4.4</b> Numeric data only</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="simulated-output.html"><a href="simulated-output.html"><i class="fa fa-check"></i><b>5</b> Simulated output</a><ul>
<li class="chapter" data-level="5.1" data-path="simulated-output.html"><a href="simulated-output.html#coersion-methods"><i class="fa fa-check"></i><b>5.1</b> Coersion methods</a></li>
<li class="chapter" data-level="5.2" data-path="simulated-output.html"><a href="simulated-output.html#query-methods"><i class="fa fa-check"></i><b>5.2</b> Query methods</a></li>
<li class="chapter" data-level="5.3" data-path="simulated-output.html"><a href="simulated-output.html#methods-for-dplyr-verbs"><i class="fa fa-check"></i><b>5.3</b> Methods for <code>dplyr</code> verbs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topics.html"><a href="topics.html"><i class="fa fa-check"></i><b>6</b> Topics</a><ul>
<li class="chapter" data-level="6.1" data-path="topics.html"><a href="topics.html#topic-annotated"><i class="fa fa-check"></i><b>6.1</b> Annotated model specification</a></li>
<li class="chapter" data-level="6.2" data-path="topics.html"><a href="topics.html#topic-init"><i class="fa fa-check"></i><b>6.2</b> Set initial conditions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="topics.html"><a href="topics.html#summary"><i class="fa fa-check"></i><b>6.2.1</b> Summary</a></li>
<li class="chapter" data-level="6.2.2" data-path="topics.html"><a href="topics.html#make-a-model-only-to-examine-init-behavior"><i class="fa fa-check"></i><b>6.2.2</b> Make a model only to examine <code>init</code> behavior</a></li>
<li class="chapter" data-level="6.2.3" data-path="topics.html"><a href="topics.html#example-pkpd-model-with-initial-condition"><i class="fa fa-check"></i><b>6.2.3</b> Example PK/PD model with initial condition</a></li>
<li class="chapter" data-level="6.2.4" data-path="topics.html"><a href="topics.html#remember-calling-init-will-let-you-check-to-see-what-is-going-on"><i class="fa fa-check"></i><b>6.2.4</b> Remember: calling <code>init</code> will let you check to see what is going on</a></li>
<li class="chapter" data-level="6.2.5" data-path="topics.html"><a href="topics.html#set-initial-conditions-via-idata"><i class="fa fa-check"></i><b>6.2.5</b> Set initial conditions via <code>idata</code></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="topics.html"><a href="topics.html#topic-parameter-update"><i class="fa fa-check"></i><b>6.3</b> Updating parameters</a><ul>
<li class="chapter" data-level="6.3.1" data-path="topics.html"><a href="topics.html#parameter-update-hierarchy"><i class="fa fa-check"></i><b>6.3.1</b> Parameter update hierarchy</a></li>
<li class="chapter" data-level="6.3.2" data-path="topics.html"><a href="topics.html#topic-parameter-update-base"><i class="fa fa-check"></i><b>6.3.2</b> Updating the base parameter list</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="topics.html"><a href="topics.html#topic-tgrid"><i class="fa fa-check"></i><b>6.4</b> Time grid objects</a></li>
<li class="chapter" data-level="6.5" data-path="topics.html"><a href="topics.html#topic-designs"><i class="fa fa-check"></i><b>6.5</b> Individualized sampling designs</a></li>
<li class="chapter" data-level="6.6" data-path="topics.html"><a href="topics.html#some-helpful-c"><i class="fa fa-check"></i><b>6.6</b> Some helpful <code>C++</code></a></li>
<li class="chapter" data-level="6.7" data-path="topics.html"><a href="topics.html#resimulate-eta-and-eps"><i class="fa fa-check"></i><b>6.7</b> Resimulate <code>ETA</code> and <code>EPS</code></a></li>
<li class="chapter" data-level="6.8" data-path="topics.html"><a href="topics.html#topic-matrix-update"><i class="fa fa-check"></i><b>6.8</b> Updating <code>$OMEGA</code> and <code>$SIGMA</code>  </a><ul>
<li class="chapter" data-level="6.8.1" data-path="topics.html"><a href="topics.html#matrix-helper-functions"><i class="fa fa-check"></i><b>6.8.1</b> Matrix helper functions</a></li>
<li class="chapter" data-level="6.8.2" data-path="topics.html"><a href="topics.html#example-unnamed-matrix"><i class="fa fa-check"></i><b>6.8.2</b> Example: unnamed matrix</a></li>
<li class="chapter" data-level="6.8.3" data-path="topics.html"><a href="topics.html#example-named-matrices"><i class="fa fa-check"></i><b>6.8.3</b> Example: named matrices</a></li>
<li class="chapter" data-level="6.8.4" data-path="topics.html"><a href="topics.html#example-unnamed-matrices"><i class="fa fa-check"></i><b>6.8.4</b> Example: unnamed matrices</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="topics.html"><a href="topics.html#topics-time-varying"><i class="fa fa-check"></i><b>6.9</b> Time varying covariates</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-sequence.html"><a href="section-sequence.html"><i class="fa fa-check"></i><b>7</b> Simulation sequence</a><ul>
<li class="chapter" data-level="7.1" data-path="section-sequence.html"><a href="section-sequence.html#functions-to-call"><i class="fa fa-check"></i><b>7.1</b> Functions to call</a></li>
<li class="chapter" data-level="7.2" data-path="section-sequence.html"><a href="section-sequence.html#problem-initiation"><i class="fa fa-check"></i><b>7.2</b> Problem initiation</a></li>
<li class="chapter" data-level="7.3" data-path="section-sequence.html"><a href="section-sequence.html#subject-initiation"><i class="fa fa-check"></i><b>7.3</b> Subject initiation</a></li>
<li class="chapter" data-level="7.4" data-path="section-sequence.html"><a href="section-sequence.html#sequence-for-a-single-record"><i class="fa fa-check"></i><b>7.4</b> Sequence for a single record</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>8</b> Installation</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><font color='DarkGreen'>mrgsolve User Guide</font></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="input-data-sets" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Input data sets</h1>
<p>Input data sets are used in <code>mrgsolve</code> to allow the user to specify interventions and input data items.</p>
<p>Please see the <code>mrgsolve</code> help topic <code>?exdatasets</code> for examples of all of the data sets discussed in this chapter. The example data sets are embedded in the <code>mrgsolve</code> package and may be used at any time.</p>
<div id="datasets" class="section level2">
<h2><span class="header-section-number">4.1</span> Overview</h2>
<p>Data sets are the primary mechanism for establishing the scope of your simulations in <code>mrsolve</code>, including individuals, interventions, observation times, and parameter values. For both <code>data_set</code> and <code>idata_set</code> (see below), you may include columns in the data sets that have the same names as the parameters in your model (section <a href="model-components.html#component-param">2.1</a>, <a href="model-specification.html#block-param">3.2.2</a>). <code>mrgsolve</code> can recognize these columns and update the parameter list as the simulation proceeds. This process is of key importance when planning and executing complex simulations and is further discussed in section <a href="topics.html#topic-parameter-update">6.3</a>.</p>
</div>
<div id="data-set" class="section level2">
<h2><span class="header-section-number">4.2</span> Event data sets (<code>data</code>)</h2>
<p>Event data sets are entered as <code>data.frame</code>, with one event per row. Events may be observations, doses, or other type events. In <code>mrgsolve</code> documentation, we refer to these data sets as <code>data</code> or <code>data_set</code> (after the function that is used to associate the data set with the model object prior to simulation).</p>
<p>Event data sets have several special column names that <code>mrgsolve</code> is always aware of:</p>
<ul>
<li><code>ID</code> the subject id. This id does not need to be unique in the <code>data_set</code>: <code>mrgsolve</code> detects an new individual when the current value of <code>ID</code> is different from the immediate preceeding value of <code>ID</code>. However, we always recommend using unique <code>ID</code>.</li>
<li><code>time</code> states the time of the data record</li>
<li><p><code>evid</code> is the event id indicator. <code>evid</code> can take the values:</p>
<ul>
<li><strong>0</strong> = observation record</li>
<li><strong>1</strong> = dosing event (bolus or infusion)</li>
<li><strong>2</strong> = other type event</li>
<li><strong>3</strong> = system reset</li>
<li><strong>4</strong> = reset and dose</li>
<li><strong>8</strong> = replace the amount in the compartment with <code>amt</code></li>
</ul></li>
<li><code>amt</code> the dose amount (if <code>evid==1</code>)</li>
<li><code>cmt</code> the dosing compartment number. This may also be a character value naming the compartment name</li>
<li><code>rate</code> if non-zero and <code>evid=1</code>, implements a zero-order infusion of duration <code>F*amt/rate</code>, where <code>F</code> is the bioavailability fraction for the dosing compartment. Use <code>rate = -1</code> to model the infusion rate and <code>rate = -2</code> to model the infusion duration, both in <code>$MAIN</code> (see sections <a href="model-specification.html#block-main">3.2.5</a>, <a href="model-specification.html#spec-f">3.3.15</a>,<a href="model-specification.html#spec-r">3.3.17</a>, <a href="model-specification.html#spec-d">3.3.18</a>).</li>
<li><code>ii</code> inter-dose interval; <code>ii=24</code> means daily dosing</li>
<li><code>addl</code> additional doses; a non-zero value in <code>addl</code> requires non-zero <code>ii</code> on the same record</li>
<li><p><code>ss</code> steady state indicator; use 1 to implement steady-state dosing; 0 otherwise. <code>mrgsolve</code> also recoginzes dosing records where <code>ss=2</code>. This allows combination of different steady state dosing regimens under linear kinetics (e.g. 10 mg QAM and 20 mg QPM daily to steady state).</p></li>
</ul>
<p>In addition to these special column names, <code>mrgsolve</code> will recognize columns in <code>data_set</code> that have the same name as items in the parameter list (see <a href="model-specification.html#block-param">3.2.2</a> and <a href="model-components.html#component-param">2.1</a>). When <code>mrgsolve</code> sees that the names match up, it will update the values of those matching names based on what it finds as it moves through the data set (see section @(topic-parameter-update)).</p>
<div id="two-types-of-data_set" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Two types of <code>data_set</code></h3>
<p><code>mrgsolve</code> distinguishes between two types of data sets: data sets that have <em>at least one observation record</em> (<code>evid=0</code>) and data sets that have <em>no records with <code>evid=0</code></em>.</p>
<ul>
<li><strong>Full data sets</strong> have a mix of observations and dosing events (likely, but not required). When <code>mrgsolve</code> finds one record with <code>evid=0</code>, it assumes that <strong>ALL</strong> output observation times are to come from the data set. In this case the simulation output time grid discussed in <a href="model-components.html#component-stime">2.3</a> is ignored and only observations found in the data set appear in the simulated output. Use full data sets when you want a highly customized sampling schedule or you are working with a clinical data set.</li>
<li><strong>Condensed data sets</strong> have no records with <code>evid=0</code>. In this case, <code>mrgsolve</code> will fill the simulated output with observations at times specified by the output time grid ( section <a href="model-components.html#component-stime">2.3</a> and see section <a href="topics.html#topic-designs">6.5</a>). These are very convenient to use because there is less data assembly burden and output data sets can easily be created with very dense sampling scheme or highly customised sampling schemes with very little work. Use a condensed data set when you want a uniform set of sampling times for all subjects in the data set.</li>
</ul>
<p><strong>Example of condensed data set</strong> data(extran1)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(extran1)
extran1</code></pre></div>
<pre><code>.   ID  amt cmt time addl ii rate evid
. 1  1 1000   1    0    3 24    0    1
. 2  2 1000   2    0    0  0   20    1
. 3  3 1000   1    0    0  0    0    1
. 4  3  500   1   24    0  0    0    1
. 5  3  500   1   48    0  0    0    1
. 6  3 1000   1   72    0  0    0    1
. 7  4 2000   2    0    2 48  100    1
. 8  5 1000   1    0    0  0    0    1
. 9  5 5000   1   24    0  0   60    1</code></pre>
<p>See <code>?exdatasets</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
<p><strong>Example of full data set</strong> data(extran1)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(exTheoph)
<span class="kw">head</span>(exTheoph)</code></pre></div>
<pre><code>.   ID   WT Dose time  conc cmt  amt evid
. 1  1 79.6 4.02 0.00  0.00   1 4.02    1
. 2  1 79.6 4.02 0.25  2.84   0 0.00    0
. 3  1 79.6 4.02 0.57  6.57   0 0.00    0
. 4  1 79.6 4.02 1.12 10.50   0 0.00    0
. 5  1 79.6 4.02 2.02  9.66   0 0.00    0
. 6  1 79.6 4.02 3.82  8.58   0 0.00    0</code></pre>
<p>See <code>?exdatasets</code> in the <code>R</code> help system after loading <code>mrgsolve</code>.</p>
<p><strong>Augmenting observations in a clinical data set</strong> Occassionally, we want to simulate from a clinical data set (with observation records as actually observed in a population of patients) but we also want to augment those observations with a regular sequence of times (for example, to make a smooth profile on a plot). In that case, you can set <code>obsaug  = TRUE</code> when calling <code>mrgsim</code>.</p>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>()

out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">data_set</span>(exTheoph, ID<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">carry.out</span>(a.u.g) <span class="op">%&gt;%</span>
<span class="st">    </span>obsaug <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="dv">24</span>, <span class="dt">delta=</span><span class="dv">1</span>)

out</code></pre></div>
<pre><code>. Model:  housemodel 
. Dim:    36 x 8 
. Time:   0 to 24.37 
. ID:     1 
.      ID time a.u.g    GUT  CENT  RESP      DV      CP
. [1,]  1 0.00     1 0.0000 0.000 50.00 0.00000 0.00000
. [2,]  1 0.00     0 4.0200 0.000 50.00 0.00000 0.00000
. [3,]  1 0.25     0 2.9781 1.035 49.95 0.04552 0.04552
. [4,]  1 0.57     0 2.0285 1.961 49.81 0.08624 0.08624
. [5,]  1 1.00     1 1.2108 2.729 49.61 0.12001 0.12001
. [6,]  1 1.12     0 1.0484 2.875 49.57 0.12643 0.12643
. [7,]  1 2.00     1 0.3647 3.422 49.34 0.15048 0.15048
. [8,]  1 2.02     0 0.3560 3.428 49.33 0.15072 0.15072</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(time) <span class="op">%&gt;%</span><span class="st"> </span>unlist <span class="op">%&gt;%</span><span class="st"> </span>unname</code></pre></div>
<pre><code>.  [1]  0.00  0.00  0.25  0.57  1.00  1.12  2.00  2.02  3.00  3.82  4.00
. [12]  5.00  5.10  6.00  7.00  7.03  8.00  9.00  9.05 10.00 11.00 12.00
. [23] 12.12 13.00 14.00 15.00 16.00 17.00 18.00 19.00 20.00 21.00 22.00
. [34] 23.00 24.00 24.37</code></pre>
<p><code>obsaug</code> requests that the data set be augmented with observations from the simulation time grid. We can optionally request an indicator called <code>a.u.g</code> to appear in the output that takes value of 1 for augmented observations and 0 for observations from the data set.</p>
</div>
<div id="sorting-requirements" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Sorting requirements</h3>
<p>The <code>ID</code>s in the data set can appear in any order. However, an error will be generated if <code>time</code> on any record is less that <code>time</code> on the previous record within any <code>ID</code>.</p>
</div>
<div id="creating-data-sets" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Creating data sets</h3>
<p>The <code>expand.ev</code> function is provided by <code>mrgsolve</code> to help in creating data sets of a certain style. But any <code>R</code> code that produces a valid data set is fine to use.</p>
</div>
<div id="example" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Example</h3>
<p>To create a data set of 3 people each receiving <strong>250 mg every 8 hours for 12 total doses</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">expand.ev</span>(<span class="dt">ID=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">amt=</span><span class="dv">250</span>, <span class="dt">ii=</span><span class="dv">8</span>, <span class="dt">addl=</span><span class="dv">11</span>)

data</code></pre></div>
<pre><code>.   ID amt ii addl evid cmt time
. 1  1 250  8   11    1   1    0
. 2  2 250  8   11    1   1    0
. 3  3 250  8   11    1   1    0</code></pre>
<p>Notice that <code>expand.ev</code> assumes that <code>time</code> is 0 and <code>cmt</code> is 1. To dose as a 2-hour infusion into the second compartment use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">expand.ev</span>(<span class="dt">ID=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">amt=</span><span class="dv">250</span>, <span class="dt">rate=</span><span class="dv">125</span>, <span class="dt">ii=</span><span class="dv">8</span>, <span class="dt">addl=</span><span class="dv">11</span>, <span class="dt">cmt=</span><span class="dv">2</span>)

data</code></pre></div>
<pre><code>.   ID amt rate ii addl cmt evid time
. 1  1 250  125  8   11   2    1    0
. 2  2 250  125  8   11   2    1    0
. 3  3 250  125  8   11   2    1    0</code></pre>
<p>Use <code>data_set</code> to pass the data into the problem.</p>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>()

mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">end=</span><span class="dv">240</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot</span>(CP<span class="op">~</span>time<span class="op">|</span><span class="kw">factor</span>(ID))</code></pre></div>
<p><img src="user-guide_files/figure-html/data_set-1-1.png" width="672" /></p>
</div>
</div>
<div id="idata-set" class="section level2">
<h2><span class="header-section-number">4.3</span> Individual data sets (<code>idata</code>)</h2>
<p>Individual data sets carry individual-level data. This individual data is used in several different ways:</p>
<ul>
<li><strong>Individual-level parameters</strong>: Just prior to simulating any individual, <code>mrgsolve</code> checks the appropriate row in <code>idata</code> (if supplied) for any columns with parameter names. If parameter names are found, the parameter list is updated and that update remains in effect for the duration of that individual’s data records.</li>
<li><strong>Individual- or group-level designs</strong>: Each individual or group of individual may be assigned a different sampling design. For example, individuals in arm 1 may need to be simulated for 4 weeks whereas individuals in arm 2 may need to be simulated for 8 weeks. <code>idata</code> may be used to identify one of several sampling designs for each individual or group of individuals.</li>
<li><strong>Individual-level compartment initialization</strong>: if a model has a compartment called <code>CMT</code> and <code>mrgsolve</code> finds a column in <code>idata</code> called <code>CMT_0</code>, the value of <code>CMT_0</code> will be used to initialize that compartment with, potentially a different value for each individual. Note that there are several other ways to initialize compartments detailed in <a href="topics.html#topic-init">6.2</a>.</li>
</ul>
<p><code>idata_set</code> are entered as <code>data.frame</code> with one unique <code>ID</code> per row. In <code>mrgsolve</code> documentation, we refer to individual data sets <code>idata</code> or <code>idata_set</code> to distinguish them from event data sets (see section <a href="input-data-sets.html#data-set">4.2</a>).</p>
<p>An <code>idata_set</code> looks like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(exidata)

exidata</code></pre></div>
<pre><code>.    ID    CL    VC     KA  KOUT  IC50 FOO
. 1   1 1.050 47.80 0.8390 2.450 1.280   4
. 2   2 0.730 30.10 0.0684 2.510 1.840   6
. 3   3 2.820 23.80 0.1180 3.880 2.480   5
. 4   4 0.552 26.30 0.4950 1.180 0.977   2
. 5   5 0.483  4.36 0.1220 2.350 0.483  10
. 6   6 3.620 39.80 0.1260 1.890 4.240   1
. 7   7 0.395 12.10 0.0317 1.250 0.802   8
. 8   8 1.440 31.20 0.0931 4.030 1.310   7
. 9   9 2.570 18.20 0.0570 0.862 1.950   3
. 10 10 2.000  6.51 0.1540 3.220 0.699   9</code></pre>
<p>Here we have an <code>idata_set</code> with 10 subjects, one subject per row. The <code>ID</code> column connects the data in each row to the data in a <code>data_set</code>, which also requires an <code>ID</code> column.</p>
<p>The <code>ID</code> column is the only required column name in <code>idata_set</code> and <code>ID</code> should always be a unique identifier for that row.</p>
<div id="use-case" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Use case</h3>
<p><code>idata_set</code> is usually helpful for implementing a batch of simulations when a <code>data_set</code> is not used. The batch may be as a sensitivity analysis or for population simulation. Usually, an events object is used with <code>idata</code>, but it is not required.</p>
<p>Use the <code>idata_set</code> function to pass the data set into the problem.</p>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span>mrgsolve<span class="op">:::</span><span class="kw">house</span>()

mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">idata_set</span>(exidata) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ev</span>(<span class="dt">amt=</span><span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>mrgsim <span class="op">%&gt;%</span><span class="st"> </span>plot</code></pre></div>
<p><img src="user-guide_files/figure-html/idata_set-1-1.png" width="672" /></p>
<p>Because there were 10 subjects in the <code>idata_set</code>, we get 10 profiles in the output. Each “individual” or “unit” received the same 100 mg dose. We would use a <code>data_set</code> to assign different doses to different individuals.</p>
</div>
</div>
<div id="numeric-only" class="section level2">
<h2><span class="header-section-number">4.4</span> Numeric data only</h2>
<p>The <code>data.frame</code> holding the <code>data_set</code> or <code>idata_set</code> may have any type of data in its columns. However, only numeric data can actually get passed into the simulation engine. <code>mrgsolve</code> will automatically look for non-numeric columns and drop them from the <code>data_set</code> or <code>idata_set</code> with a warning.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-specification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simulated-output.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["user-guide.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
