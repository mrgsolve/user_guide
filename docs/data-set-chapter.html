<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Input data sets | mrgsolve User Guide</title>
<meta name="author" content="Metrum Research Group">
<meta name="description" content="Input data sets are used in mrgsolve to allow the user to specify interventions and input data items. Please see the mrgsolve help topic ?exdatasets for examples of all of the data sets discussed...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 3 Input data sets | mrgsolve User Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mrgsolve.github.io/user_guide/data-set-chapter.html">
<meta property="og:description" content="Input data sets are used in mrgsolve to allow the user to specify interventions and input data items. Please see the mrgsolve help topic ?exdatasets for examples of all of the data sets discussed...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Input data sets | mrgsolve User Guide">
<meta name="twitter:site" content="@mrgsolve">
<meta name="twitter:description" content="Input data sets are used in mrgsolve to allow the user to specify interventions and input data items. Please see the mrgsolve help topic ?exdatasets for examples of all of the data sets discussed...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bookstyle.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mrgsolve User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="model-components.html"><span class="header-section-number">1</span> Model components</a></li>
<li><a class="" href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></li>
<li><a class="active" href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="" href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="" href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></li>
<li><a class="" href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></li>
<li><a class="" href="section-sequence.html"><span class="header-section-number">7</span> Simulation sequence</a></li>
<li><a class="" href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></li>
<li><a class="" href="plugins.html"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="" href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="" href="topics.html"><span class="header-section-number">11</span> Topics</a></li>
<li><a class="" href="q-and-a.html"><span class="header-section-number">12</span> Questions and Answers</a></li>
<li><a class="" href="install.html"><span class="header-section-number">13</span> Installation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-set-chapter" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Input data sets<a class="anchor" aria-label="anchor" href="#data-set-chapter"><i class="fas fa-link"></i></a>
</h1>
<p>Input data sets are used in mrgsolve to allow the user to specify
interventions and input data items.</p>
<p>Please see the mrgsolve help topic <code>?exdatasets</code> for examples of all of the
data sets discussed in this chapter. The example data sets are embedded in the
mrgsolve package and may be used at any time.</p>
<div id="datasets" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Overview<a class="anchor" aria-label="anchor" href="#datasets"><i class="fas fa-link"></i></a>
</h2>
<p>Data sets are the primary mechanism for establishing the scope of your
simulations in <code>mrsolve</code>, including individuals, interventions, observation
times, and parameter values. For both <code>data_set</code> and <code>idata_set</code> (see below),
you may include columns in the data sets that have the same names as the
parameters in your model (section <a href="model-components.html#component-param">1.1</a>, <a href="model-specification.html#block-param">2.2.4</a>).
mrgsolve can recognize these columns and update the parameter list as the
simulation proceeds. This process is of key importance when planning and
executing complex simulations and is further discussed in section
<a href="topics.html#topic-parameter-update">11.3</a>.</p>
</div>
<div id="data-set" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Event data sets (<code>data</code>)<a class="anchor" aria-label="anchor" href="#data-set"><i class="fas fa-link"></i></a>
</h2>
<p>Event data sets are entered as <code>data.frame</code>, with one event per row. Events may
be observations, doses, or other type events. In mrgsolve documentation, we
refer to these data sets as <code>data</code> or <code>data_set</code> (after the function that is
used to associate the data set with the model object prior to simulation).</p>
<p>Event data sets have several special column names that mrgsolve is always
aware of:</p>
<ul>
<li><p><code>ID</code> the subject id. This id does not need to be unique in the <code>data_set</code>:
mrgsolve detects an new individual when the current value of <code>ID</code> is different
from the immediate preceding value of <code>ID</code>. However, we always recommend using
unique <code>ID</code>.</p></li>
<li><p><code>time</code> or <code>TIME</code>: states the time of the data record</p></li>
<li>
<p><code>evid</code> or <code>EVID</code>: the event id indicator. <code>evid</code> can take the values:</p>
<ul>
<li>
<strong>0</strong> = observation record</li>
<li>
<strong>1</strong> = dosing event (bolus or infusion)</li>
<li>
<strong>2</strong> = other type event, with solver stop and restart</li>
<li>
<strong>3</strong> = system reset</li>
<li>
<strong>4</strong> = reset and dose</li>
<li>
<strong>8</strong> = replace the amount in the compartment with <code>amt</code>
</li>
</ul>
</li>
<li><p><code>amt</code> or <code>AMT</code>: the dose amount (if <code>evid==1</code>)</p></li>
<li><p><code>cmt</code> or <code>CMT</code>: the dosing compartment number. This may also be a character
value naming the compartment name. The compartment number must be consistent
with the number of compartments in the model for dosing records (<code>evid</code>==1).<br>
For observation records, a <code>cmt</code> value of 0 is acceptable. Use a negative
compartment number with <code>evid</code> 2 to turn a compartment off.<br></p></li>
<li><p><code>rate</code> or <code>RATE</code>: if non-zero and <code>evid=1</code> or <code>evid=4</code>, implements a
zero-order infusion of duration <code>F_CMT*amt/rate</code>, where <code>F_CMT</code> is the
bioavailability fraction for the dosing compartment. Use <code>rate = -1</code> to model
the infusion rate and <code>rate = -2</code> to model the infusion duration, both in
<code>$MAIN</code> (see sections <a href="model-specification.html#block-main">2.2.7</a>, <a href="model-specification.html#spec-f">2.3.30</a>,<a href="model-specification.html#spec-r">2.3.32</a>,
<a href="model-specification.html#spec-d">2.3.34</a>).</p></li>
<li><p><code>ii</code> or <code>II</code>: inter-dose interval; <code>ii=24</code> means daily dosing when the model
time unit is hours</p></li>
<li><p><code>addl</code> or <code>ADDL</code>: additional doses; a non-zero value in <code>addl</code> requires
non-zero <code>ii</code> on the same record</p></li>
<li><p><code>ss</code> or <code>SS</code> steady state indicator; use 1 to implement steady-state dosing; 0
otherwise. mrgsolve also recognizes dosing records where <code>ss=2</code>. This allows
combination of different steady state dosing regimens under linear kinetics
(e.g. 10 mg QAM and 20 mg QPM daily to steady state).</p></li>
</ul>
<p>The column names in the preceding list were written either as lower case form
(e.g. <code>amt</code>) or upper case form (e.g. <code>AMT</code>). Either may be used, however
the data set will be checked for consistency of usage. An error will be
issued in case a mixture of lower and upper case names are found.</p>
<p>In addition to these special column names, mrgsolve will recognize columns in
<code>data_set</code> that have the same name as items in the parameter list (see
<a href="model-specification.html#block-param">2.2.4</a> and <a href="model-components.html#component-param">1.1</a>). When mrgsolve sees that the
names match up, it will update the values of those matching names based on what
it finds as it moves through the data set (see section
<a href="topics.html#topic-parameter-update">11.3</a>).</p>
<div id="two-types-of-data_set" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Two types of <code>data_set</code><a class="anchor" aria-label="anchor" href="#two-types-of-data_set"><i class="fas fa-link"></i></a>
</h3>
<p>mrgsolve distinguishes between two types of data sets: data sets that have <em>at
least one observation record</em> (<code>evid=0</code>) and data sets that have <em>no records
with <code>evid=0</code></em>.</p>
<ul>
<li>
<strong>Full data sets</strong> have a mix of observations and dosing events (likely, but
not required). When mrgsolve finds one record with <code>evid=0</code>, it assumes that
<strong>ALL</strong> output observation times are to come from the data set. In this case the
simulation output time grid discussed in <a href="model-components.html#component-stime">1.3</a> is ignored and
only observations found in the data set appear in the simulated output. Use
full data sets when you want a highly customized sampling schedule or you are
working with a clinical data set.</li>
<li>
<strong>Condensed data sets</strong> have no records with <code>evid=0</code>. In this case,
mrgsolve will fill the simulated output with observations at times specified
by the output time grid ( section <a href="model-components.html#component-stime">1.3</a> and see section
<a href="topics.html#topic-designs">11.5</a>). These are very convenient to use because there is less
data assembly burden and output data sets can easily be created with very dense
sampling scheme or highly customized sampling schemes with very little work.
Use a condensed data set when you want a uniform set of sampling times for all
subjects in the data set.</li>
</ul>
<p><strong>Example of condensed data set</strong></p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">extran1</span>, package <span class="op">=</span> <span class="st">"mrgsolve"</span><span class="op">)</span>
<span class="va">extran1</span></code></pre></div>
<pre><code>.   ID  amt cmt time addl ii rate evid
. 1  1 1000   1    0    3 24    0    1
. 2  2 1000   2    0    0  0   20    1
. 3  3 1000   1    0    0  0    0    1
. 4  3  500   1   24    0  0    0    1
. 5  3  500   1   48    0  0    0    1
. 6  3 1000   1   72    0  0    0    1
. 7  4 2000   2    0    2 48  100    1
. 8  5 1000   1    0    0  0    0    1
. 9  5 5000   1   24    0  0   60    1</code></pre>
<p>See <code>?exdatasets</code> in the <code>R</code> help system after loading mrgsolve.</p>
<p><strong>Example of full data set</strong></p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exTheoph</span>, package <span class="op">=</span> <span class="st">"mrgsolve"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">exTheoph</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID   WT Dose time  conc cmt  amt evid
. 1  1 79.6 4.02 0.00  0.00   1 4.02    1
. 2  1 79.6 4.02 0.25  2.84   0 0.00    0
. 3  1 79.6 4.02 0.57  6.57   0 0.00    0
. 4  1 79.6 4.02 1.12 10.50   0 0.00    0
. 5  1 79.6 4.02 2.02  9.66   0 0.00    0
. 6  1 79.6 4.02 3.82  8.58   0 0.00    0</code></pre>
<p>See <code>?exdatasets</code> in the <code>R</code> help system after loading mrgsolve.</p>
<p><strong>Augmenting observations in a clinical data set</strong>
Occasionally, we want to simulate from a clinical data set (with observation
records as actually observed in a population of patients) but we also want to
augment those observations with a regular sequence of times (for example, to
make a smooth profile on a plot). In that case, you can set <code>obsaug  = TRUE</code>
when calling <code>mrgsim</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mrgsolve</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/house.html">house</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">out</span> <span class="op">&lt;-</span> 
  <span class="va">mod</span> <span class="op">%&gt;%</span>
    <span class="fu">data_set</span><span class="op">(</span><span class="va">exTheoph</span>, <span class="va">ID</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">carry.out</span><span class="op">(</span><span class="va">a.u.g</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="va">obsaug</span> <span class="op">%&gt;%</span>
    <span class="fu">mrgsim</span><span class="op">(</span>end<span class="op">=</span><span class="fl">24</span>, delta<span class="op">=</span><span class="fl">1</span><span class="op">)</span>

<span class="va">out</span></code></pre></div>
<pre><code>. Model:  housemodel 
. Dim:    36 x 8 
. Time:   0 to 24.37 
. ID:     1 
.     ID time a.u.g    GUT  CENT  RESP      DV      CP
. 1:   1 0.00     1 0.0000 0.000 50.00 0.00000 0.00000
. 2:   1 0.00     0 4.0200 0.000 50.00 0.00000 0.00000
. 3:   1 0.25     0 2.9781 1.035 49.95 0.04552 0.04552
. 4:   1 0.57     0 2.0285 1.961 49.81 0.08624 0.08624
. 5:   1 1.00     1 1.2108 2.729 49.61 0.12001 0.12001
. 6:   1 1.12     0 1.0484 2.875 49.57 0.12643 0.12643
. 7:   1 2.00     1 0.3647 3.422 49.34 0.15048 0.15048
. 8:   1 2.02     0 0.3560 3.428 49.33 0.15072 0.15072</code></pre>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="va">unlist</span> <span class="op">%&gt;%</span> <span class="va">unname</span></code></pre></div>
<pre><code>.  [1]  0.00  0.00  0.25  0.57  1.00  1.12  2.00  2.02  3.00  3.82  4.00  5.00
. [13]  5.10  6.00  7.00  7.03  8.00  9.00  9.05 10.00 11.00 12.00 12.12 13.00
. [25] 14.00 15.00 16.00 17.00 18.00 19.00 20.00 21.00 22.00 23.00 24.00 24.37</code></pre>
<p><code>obsaug</code> requests that the data set be augmented with observations from the
simulation time grid. We can optionally request an indicator called <code>a.u.g</code> to
appear in the output that takes value of 1 for augmented observations and 0 for
observations from the data set.</p>
</div>
<div id="sorting-requirements" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Sorting requirements<a class="anchor" aria-label="anchor" href="#sorting-requirements"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>ID</code>s in the data set can appear in any order. However, an error will be
generated if <code>time</code> on any record is less that <code>time</code> on the previous record
within any <code>ID</code>.</p>
</div>
<div id="creating-data-sets" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Creating data sets<a class="anchor" aria-label="anchor" href="#creating-data-sets"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>expand.ev</code> function is provided by mrgsolve to help in creating data sets
of a certain style. But any <code>R</code> code that produces a valid data set is fine to
use.</p>
</div>
<div id="example" class="section level3" number="3.2.4">
<h3>
<span class="header-section-number">3.2.4</span> Example<a class="anchor" aria-label="anchor" href="#example"><i class="fas fa-link"></i></a>
</h3>
<p>To create a data set of 3 people each receiving <strong>250 mg every 8 hours for 12 total doses</strong>:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">expand.ev</span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, amt<span class="op">=</span><span class="fl">250</span>, ii<span class="op">=</span><span class="fl">8</span>, addl<span class="op">=</span><span class="fl">11</span><span class="op">)</span>

<span class="va">data</span></code></pre></div>
<pre><code>.   ID time amt ii addl cmt evid
. 1  1    0 250  8   11   1    1
. 2  2    0 250  8   11   1    1
. 3  3    0 250  8   11   1    1</code></pre>
<p>Notice that <code>expand.ev</code> assumes that <code>time</code> is 0 and <code>cmt</code> is 1. To dose as a
2-hour infusion into the second compartment use:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">expand.ev</span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, amt<span class="op">=</span><span class="fl">250</span>, rate<span class="op">=</span><span class="fl">125</span>, ii<span class="op">=</span><span class="fl">8</span>, addl<span class="op">=</span><span class="fl">11</span>, cmt<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="va">data</span></code></pre></div>
<pre><code>.   ID time amt rate ii addl cmt evid
. 1  1    0 250  125  8   11   2    1
. 2  2    0 250  125  8   11   2    1
. 3  3    0 250  125  8   11   2    1</code></pre>
<p>Use <code>data_set</code> to pass the data into the problem.</p>
<p>For example:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mrgsolve</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/house.html">house</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">%&gt;%</span>
  <span class="fu">data_set</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mrgsim</span><span class="op">(</span>end<span class="op">=</span><span class="fl">240</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">CP</span><span class="op">~</span><span class="va">time</span><span class="op">|</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="user-guide_files/figure-html/data_set-1-1.png" width="672"></div>
</div>
</div>
<div id="idata-set" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Individual data sets (<code>idata</code>)<a class="anchor" aria-label="anchor" href="#idata-set"><i class="fas fa-link"></i></a>
</h2>
<p>Individual data sets carry individual-level data. This individual data is used
in several different ways:</p>
<ul>
<li>
<strong>Individual-level parameters</strong>: Just prior to simulating any individual,
mrgsolve checks the appropriate row in <code>idata</code> (if supplied) for any columns
with parameter names. If parameter names are found, the parameter list is
updated and that update remains in effect for the duration of that individual’s
data records.</li>
<li>
<strong>Individual- or group-level designs</strong>: Each individual or group of individual
may be assigned a different sampling design. For example, individuals in arm 1
may need to be simulated for 4 weeks whereas individuals in arm 2 may need to be
simulated for 8 weeks. <code>idata</code> may be used to identify one of several sampling
designs for each individual or group of individuals.</li>
<li>
<strong>Individual-level compartment initialization</strong>: if a model has a compartment
called <code>CMT</code> and mrgsolve finds a column in <code>idata</code> called <code>CMT_0</code>, the value
of <code>CMT_0</code> will be used to initialize that compartment with, potentially a
different value for each individual. Note that there are several other ways to
initialize compartments detailed in <a href="topics.html#topic-init">11.2</a>.</li>
</ul>
<p><code>idata_set</code> are entered as <code>data.frame</code> with one unique <code>ID</code> per row. In
mrgsolve documentation, we refer to individual data sets <code>idata</code> or
<code>idata_set</code> to distinguish them from event data sets (see section
<a href="data-set-chapter.html#data-set">3.2</a>).</p>
<p>An <code>idata_set</code> looks like this:</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exidata</span><span class="op">)</span>

<span class="va">exidata</span></code></pre></div>
<pre><code>.    ID    CL    VC     KA  KOUT  IC50 FOO
. 1   1 1.050 47.80 0.8390 2.450 1.280   4
. 2   2 0.730 30.10 0.0684 2.510 1.840   6
. 3   3 2.820 23.80 0.1180 3.880 2.480   5
. 4   4 0.552 26.30 0.4950 1.180 0.977   2
. 5   5 0.483  4.36 0.1220 2.350 0.483  10
. 6   6 3.620 39.80 0.1260 1.890 4.240   1
. 7   7 0.395 12.10 0.0317 1.250 0.802   8
. 8   8 1.440 31.20 0.0931 4.030 1.310   7
. 9   9 2.570 18.20 0.0570 0.862 1.950   3
. 10 10 2.000  6.51 0.1540 3.220 0.699   9</code></pre>
<p>Here we have an <code>idata_set</code> with 10 subjects, one subject per row. The <code>ID</code>
column connects the data in each row to the data in a <code>data_set</code>, which also
requires an <code>ID</code> column.</p>
<p>The <code>ID</code> column is the only required column name in <code>idata_set</code> and <code>ID</code> should
always be a unique identifier for that row.</p>
<div id="use-case" class="section level3" number="3.3.1">
<h3>
<span class="header-section-number">3.3.1</span> Use case<a class="anchor" aria-label="anchor" href="#use-case"><i class="fas fa-link"></i></a>
</h3>
<p><code>idata_set</code> is usually helpful for implementing a batch of simulations when a
<code>data_set</code> is not used. The batch may be as a sensitivity analysis or for
population simulation. Usually, an events object is used with <code>idata</code>, but it
is not required.</p>
<p>Use the <code>idata_set</code> function to pass the data set into the problem.</p>
<p>For example:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">mrgsolve</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/mrgsolve/man/house.html">house</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">%&gt;%</span>
  <span class="fu">idata_set</span><span class="op">(</span><span class="va">exidata</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ev</span><span class="op">(</span>amt<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">mrgsim</span> <span class="op">%&gt;%</span> <span class="va">plot</span></code></pre></div>
<div class="inline-figure"><img src="user-guide_files/figure-html/idata_set-1-1.png" width="672"></div>
<p>Because there were 10 subjects in the <code>idata_set</code>, we get 10 profiles in the
output. Each “individual” or “unit” received the same 100 mg dose. We would
use a <code>data_set</code> to assign different doses to different individuals.</p>
</div>
</div>
<div id="numeric-only" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Numeric data only<a class="anchor" aria-label="anchor" href="#numeric-only"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>data.frame</code> holding the <code>data_set</code> or <code>idata_set</code> may have any type of data
in its columns. However, only numeric data can actually get passed into the
simulation engine. mrgsolve will automatically look for non-numeric columns
and drop them from the <code>data_set</code> or <code>idata_set</code> with a warning.</p>
</div>
<div id="valid_data_set" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Data set validation<a class="anchor" aria-label="anchor" href="#valid_data_set"><i class="fas fa-link"></i></a>
</h2>
<p>A the time of simulation, mrgsolve will validate the input data set, removing
non-numeric columns, checking for missing values in parameter columns, checking
compartment numbers, etc.</p>
<p>Users can pre-validate the data set so that this does not need to happen at
run time.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exTheoph</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">exTheoph</span><span class="op">)</span></code></pre></div>
<pre><code>.   ID   WT Dose time  conc cmt  amt evid
. 1  1 79.6 4.02 0.00  0.00   1 4.02    1
. 2  1 79.6 4.02 0.25  2.84   0 0.00    0
. 3  1 79.6 4.02 0.57  6.57   0 0.00    0
. 4  1 79.6 4.02 1.12 10.50   0 0.00    0
. 5  1 79.6 4.02 2.02  9.66   0 0.00    0
. 6  1 79.6 4.02 3.82  8.58   0 0.00    0</code></pre>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">modlib</span><span class="op">(</span><span class="st">"pk1"</span><span class="op">)</span></code></pre></div>
<pre><code>. Loading model from cache.</code></pre>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">valid</span> <span class="op">&lt;-</span> <span class="fu">valid_data_set</span><span class="op">(</span><span class="va">exTheoph</span>,<span class="va">mod</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">valid</span><span class="op">)</span></code></pre></div>
<pre><code>.  'valid_data_set' num [1:132, 1:9] 1 1 1 1 1 1 1 1 1 1 ...
.  - attr(*, "dimnames")=List of 2
.   ..$ : NULL
.   ..$ : chr [1:9] "ID" "WT" "Dose" "time" ...</code></pre>
<p>This can improve efficiency when performing a very large number of replicate
simulations on the same data set, but is unlikely to provide a meaningful
speed-up for a single simulation or a small number of simulations.</p>
</div>
<div id="pred-data" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Data sets for use with <code>$PRED</code><a class="anchor" aria-label="anchor" href="#pred-data"><i class="fas fa-link"></i></a>
</h2>
<p>Because there are no compartments involved, there are relaxed data set
requirements for models that utilize <code>$PRED</code>.</p>
<ul>
<li>
<code>time</code> or <code>TIME</code> is not required as input; when this is not supplied, a
<code>time</code> column will be included in output with value 0</li>
<li>When <code>time</code> or <code>TIME</code> is supplied, it may be negative; but records must still
be sorted by <code>time</code> or <code>TIME</code>
</li>
<li>If supplied, <code>cmt</code> or <code>CMT</code> must be zero</li>
<li>An error is generated if <code>rate</code> or <code>RATE</code> is supplied</li>
<li>An error is generated if <code>ss</code> or <code>SS</code> is supplied</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></div>
<div class="next"><a href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-set-chapter"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="nav-link" href="#datasets"><span class="header-section-number">3.1</span> Overview</a></li>
<li>
<a class="nav-link" href="#data-set"><span class="header-section-number">3.2</span> Event data sets (data)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#two-types-of-data_set"><span class="header-section-number">3.2.1</span> Two types of data_set</a></li>
<li><a class="nav-link" href="#sorting-requirements"><span class="header-section-number">3.2.2</span> Sorting requirements</a></li>
<li><a class="nav-link" href="#creating-data-sets"><span class="header-section-number">3.2.3</span> Creating data sets</a></li>
<li><a class="nav-link" href="#example"><span class="header-section-number">3.2.4</span> Example</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#idata-set"><span class="header-section-number">3.3</span> Individual data sets (idata)</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#use-case"><span class="header-section-number">3.3.1</span> Use case</a></li></ul>
</li>
<li><a class="nav-link" href="#numeric-only"><span class="header-section-number">3.4</span> Numeric data only</a></li>
<li><a class="nav-link" href="#valid_data_set"><span class="header-section-number">3.5</span> Data set validation</a></li>
<li><a class="nav-link" href="#pred-data"><span class="header-section-number">3.6</span> Data sets for use with $PRED</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mrgsolve User Guide</strong>" was written by Metrum Research Group. It was last built on 2022-06-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
