<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Modeled events | mrgsolve User Guide</title>
<meta name="author" content="Metrum Research Group">
<meta name="description" content="Modeled events are interventions that you can introduce into your simulation from within your model. These aren’t any different in substance to the dosing records (EVID=1) or other intervention...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="Chapter 10 Modeled events | mrgsolve User Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://mrgsolve.github.io/user_guide/mtime.html">
<meta property="og:description" content="Modeled events are interventions that you can introduce into your simulation from within your model. These aren’t any different in substance to the dosing records (EVID=1) or other intervention...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Modeled events | mrgsolve User Guide">
<meta name="twitter:site" content="@mrgsolve">
<meta name="twitter:description" content="Modeled events are interventions that you can introduce into your simulation from within your model. These aren’t any different in substance to the dosing records (EVID=1) or other intervention...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bookstyle.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">mrgsolve User Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="model-components.html"><span class="header-section-number">1</span> Model components</a></li>
<li><a class="" href="model-specification.html"><span class="header-section-number">2</span> Model specification</a></li>
<li><a class="" href="data-set-chapter.html"><span class="header-section-number">3</span> Input data sets</a></li>
<li><a class="" href="event-chapter.html"><span class="header-section-number">4</span> Event objects</a></li>
<li><a class="" href="matrix-chapter.html"><span class="header-section-number">5</span> Model Matrices</a></li>
<li><a class="" href="simulated-output.html"><span class="header-section-number">6</span> Simulated output</a></li>
<li><a class="" href="section-sequence.html"><span class="header-section-number">7</span> Simulation sequence</a></li>
<li><a class="" href="steady-state.html"><span class="header-section-number">8</span> Steady state</a></li>
<li><a class="" href="plugins.html"><span class="header-section-number">9</span> Plugins</a></li>
<li><a class="active" href="mtime.html"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="" href="topics.html"><span class="header-section-number">11</span> Topics</a></li>
<li><a class="" href="q-and-a.html"><span class="header-section-number">12</span> Questions and Answers</a></li>
<li><a class="" href="install.html"><span class="header-section-number">13</span> Installation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mtime" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Modeled events<a class="anchor" aria-label="anchor" href="#mtime"><i class="fas fa-link"></i></a>
</h1>
<p>Modeled events are interventions that you can introduce into your
simulation from within your model. These aren’t any different in substance to
the dosing records (<code>EVID=1</code>) or other intervention type records (<code>EVID=2</code>)
that you might include in your input data set when you know what they are
before you run the simulation. Modeled events do the same thing (stop the
simulation and execute some event at some time) but you don’t need to know
about them prior to running the simulation. These are similar to the <code>MTIME</code>
functionality that you get in NONMEM but they have a very different syntax and
there is more functionality provided.</p>
<p>Note that there is no way to get additional records in your simulated output.
Regardless of the approach or level of complexity, you will not see modeled
events in your simulated output. These are always executed under the hood and
the number of rows in the simulated output and their times will be the same
regardless of what modeled events you set up as discussed here.</p>
<div id="simple-mtime" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Simple MTIME<a class="anchor" aria-label="anchor" href="#simple-mtime"><i class="fas fa-link"></i></a>
</h2>
<p>Use this when you just want to introduce a non-dose discontinuity in your
simulation at a specific time. For example, you want a parameter to change
value at a specific time and you don’t know about the values or times prior
to simulating.</p>
<p>To schedule a discontinuity, call the <code>mtime()</code> member (Section @ref(self.time))
of the <code>self</code> object (Section <a href="model-specification.html#self-object">2.3.12</a>). This is typically done in
the <code>$MAIN</code> block.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb369-1"><a href="mtime.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span></span>
<span id="cb369-2"><a href="mtime.html#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> mt <span class="op">=</span> self<span class="op">.</span>mtime<span class="op">(</span><span class="fl">14.12</span><span class="op">);</span></span>
<span id="cb369-3"><a href="mtime.html#cb369-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-4"><a href="mtime.html#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>TIME <span class="op">&gt;=</span> mt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb369-5"><a href="mtime.html#cb369-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// do something  </span></span>
<span id="cb369-6"><a href="mtime.html#cb369-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here, we have told <code>mrgsolve</code> to stop at <code>14.12</code> hours so we can do something.
Notice that <code>self.mtime()</code> returns the value of the modeled even time so you
can check it later.</p>
<p>We can also schedule an event to happen some amount of time in the future</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb370-1"><a href="mtime.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> main <span class="op">]</span></span>
<span id="cb370-2"><a href="mtime.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>NEWIND <span class="op">&lt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb370-3"><a href="mtime.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> mt <span class="op">=</span> <span class="fl">1e9</span><span class="op">;</span>  </span>
<span id="cb370-4"><a href="mtime.html#cb370-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb370-5"><a href="mtime.html#cb370-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-6"><a href="mtime.html#cb370-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>EVID<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb370-7"><a href="mtime.html#cb370-7" aria-hidden="true" tabindex="-1"></a>  mt <span class="op">=</span> self<span class="op">.</span>mtime<span class="op">(</span>TIME <span class="op">+</span> <span class="fl">8.2</span><span class="op">);</span></span>
<span id="cb370-8"><a href="mtime.html#cb370-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb370-9"><a href="mtime.html#cb370-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-10"><a href="mtime.html#cb370-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>TIME <span class="op">&gt;=</span> mt<span class="op">)</span> <span class="op">{</span></span>
<span id="cb370-11"><a href="mtime.html#cb370-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// do something  </span></span>
<span id="cb370-12"><a href="mtime.html#cb370-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="mtime-with-specific-evid" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> MTIME with specific EVID<a class="anchor" aria-label="anchor" href="#mtime-with-specific-evid"><i class="fas fa-link"></i></a>
</h2>
<p>You can call <code>self.mevent()</code> and pass both <code>time</code> and <code>evid</code> and then check
for when that <code>EVID</code> comes around again. For example</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb371-1"><a href="mtime.html#cb371-1" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span>mevent<span class="op">(</span>TIME <span class="op">+</span> <span class="fl">8.2</span><span class="op">,</span> <span class="dv">33</span><span class="op">);</span></span>
<span id="cb371-2"><a href="mtime.html#cb371-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-3"><a href="mtime.html#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>EVID<span class="op">==</span><span class="dv">33</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb371-4"><a href="mtime.html#cb371-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// do something  </span></span>
<span id="cb371-5"><a href="mtime.html#cb371-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This is similar in functionality to <code>self.mevent()</code>.</p>
</div>
<div id="modeled-doses" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Modeled doses<a class="anchor" aria-label="anchor" href="#modeled-doses"><i class="fas fa-link"></i></a>
</h2>
<p>The previous examples showed you how to get the simulation to stop so you
can do something in <code>$MAIN</code>. In this section, we show you how to schedule
doses in a similar way. This will take some extra coding and will also serve
to uncover how <code>self.mtime()</code> and <code>self.mevent()</code> work.</p>
<p>You can set up the following code in either <code>$MAIN</code> or <code>$TABLE</code>.</p>
<p><strong><em>Create an evdata object</em></strong></p>
<p>Once you know when you want the dose, create an <code>evdata</code> object.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb372-1"><a href="mtime.html#cb372-1" aria-hidden="true" tabindex="-1"></a>mrg<span class="op">::</span>evdata ev<span class="op">(</span><span class="fl">14.2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
<p>This will create (construct) an object called <code>ev</code> with class <code>evdata</code>. The
constructor takes two arguments:</p>
<ol style="list-style-type: decimal">
<li>the <code>TIME</code> the event should happen</li>
<li>the <code>EVID</code> for the event</li>
</ol>
<p>This is the only available constructor for <code>evdata</code> objects. You can browse
the source code for the <code>evdata</code> object
<a href="https://github.com/metrumresearchgroup/mrgsolve/blob/develop/inst/base/mrgsolv.h">here</a>.</p>
<p><strong>Modify the evdata object</strong>
Once the object is created, you can modify the following public members</p>
<ul>
<li>
<code>time</code>: the event time (<code>double</code>)</li>
<li>
<code>evid</code>: the event ID (<code>int</code>)</li>
<li>
<code>amt</code>: the dose amount (<code>double</code>)</li>
<li>
<code>cmt</code>: the compartment number (<code>int</code>)</li>
<li>
<code>rate</code>: the rate to infuse <code>amt</code> (<code>double</code>)</li>
<li>
<code>now</code>: should the dose be given immediately? (<code>bool</code>)</li>
</ul>
<p>If you are using this (lower-level) interface, chances are you will want to
set at least <code>amt</code> and <code>cmt</code>. As an example, we will dose 100 mg into
compartment 2 immediately (now)</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb373-1"><a href="mtime.html#cb373-1" aria-hidden="true" tabindex="-1"></a>ev<span class="op">.</span>amt <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb373-2"><a href="mtime.html#cb373-2" aria-hidden="true" tabindex="-1"></a>ev<span class="op">.</span>cmt <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb373-3"><a href="mtime.html#cb373-3" aria-hidden="true" tabindex="-1"></a>ev<span class="op">.</span>now <span class="op">=</span> true<span class="op">;</span></span></code></pre></div>
<p>The other members are set in a similar way.</p>
<p><strong>Push the evdata object into the self object</strong></p>
<p>After the object has been created and modified, you have to attach this object
to the <code>self</code> object in order to make it available to mrgsolve. Do this by
calling <code>push_back()</code> on <code>self.mevector</code></p>
<div class="sourceCode" id="cb374"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb374-1"><a href="mtime.html#cb374-1" aria-hidden="true" tabindex="-1"></a>self<span class="op">.</span>mevector<span class="op">.</span>push_back<span class="op">(</span>ev<span class="op">);</span></span></code></pre></div>
<p>Again, this sequence should get called in either <code>$MAIN</code> or <code>$TABLE</code>. When that
code block finishes running (for the current record), <code>mrgsolve</code> will find the
event record and add that event to the simulation sequence.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="plugins.html"><span class="header-section-number">9</span> Plugins</a></div>
<div class="next"><a href="topics.html"><span class="header-section-number">11</span> Topics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mtime"><span class="header-section-number">10</span> Modeled events</a></li>
<li><a class="nav-link" href="#simple-mtime"><span class="header-section-number">10.1</span> Simple MTIME</a></li>
<li><a class="nav-link" href="#mtime-with-specific-evid"><span class="header-section-number">10.2</span> MTIME with specific EVID</a></li>
<li><a class="nav-link" href="#modeled-doses"><span class="header-section-number">10.3</span> Modeled doses</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>mrgsolve User Guide</strong>" was written by Metrum Research Group. It was last built on 2023-02-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
